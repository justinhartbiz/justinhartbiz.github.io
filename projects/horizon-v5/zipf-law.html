<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zipf's Law — The Hidden Shape of Language</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #f2f0eb;
    --ink: #1a1814;
    --accent: #e63329;
    --accent2: #2563eb;
    --muted: #8c8880;
    --line: #d8d4cc;
  }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: 'Space Grotesk', sans-serif;
    min-height: 100vh;
  }

  .layout {
    display: grid;
    grid-template-columns: 380px 1fr;
    min-height: 100vh;
  }

  .sidebar {
    padding: 3rem 2.5rem;
    border-right: 1px solid var(--line);
    display: flex;
    flex-direction: column;
    gap: 2rem;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
  }

  .nav-back {
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }
  .nav-back:hover { color: var(--accent); }

  .eyebrow {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
  }

  h1 {
    font-size: 2.4rem;
    font-weight: 700;
    line-height: 1.1;
    color: var(--ink);
    margin: 0.4rem 0 0.8rem;
  }

  .description {
    font-size: 0.9rem;
    line-height: 1.7;
    color: var(--muted);
    font-weight: 300;
  }

  .formula-box {
    background: var(--ink);
    color: #f2f0eb;
    border-radius: 10px;
    padding: 1.25rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.95rem;
    line-height: 1.8;
  }

  .formula-box .comment {
    color: #666;
    font-size: 0.75rem;
  }

  .formula-box .highlight {
    color: #e63329;
  }

  .insight-box {
    background: white;
    border: 1px solid var(--line);
    border-left: 4px solid var(--accent);
    border-radius: 0 8px 8px 0;
    padding: 1.2rem;
  }

  .insight-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 0.5rem;
  }

  .insight-box p {
    font-size: 0.82rem;
    line-height: 1.65;
    color: #3a3630;
    font-style: italic;
  }

  .controls-section h3 {
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.8rem;
    font-family: 'JetBrains Mono', monospace;
  }

  .corpus-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .corpus-btn {
    background: white;
    border: 1px solid var(--line);
    border-radius: 6px;
    padding: 0.6rem 0.9rem;
    font-size: 0.8rem;
    font-family: 'Space Grotesk', sans-serif;
    cursor: pointer;
    text-align: left;
    transition: all 0.18s;
    color: var(--ink);
  }
  .corpus-btn:hover, .corpus-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .main-area {
    display: flex;
    flex-direction: column;
    padding: 2.5rem 3rem;
    gap: 2.5rem;
  }

  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .chart-title {
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .view-toggle {
    display: flex;
    gap: 0.3rem;
  }

  .toggle-btn {
    background: white;
    border: 1px solid var(--line);
    border-radius: 4px;
    padding: 0.3rem 0.7rem;
    font-size: 0.7rem;
    font-family: 'JetBrains Mono', monospace;
    cursor: pointer;
    color: var(--muted);
    transition: all 0.15s;
  }
  .toggle-btn.active, .toggle-btn:hover {
    background: var(--ink);
    color: var(--bg);
    border-color: var(--ink);
  }

  canvas {
    border: 1px solid var(--line);
    border-radius: 8px;
    background: white;
    cursor: crosshair;
  }

  .word-parade {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    max-height: 200px;
    overflow-y: auto;
  }

  .word-pill {
    border-radius: 100px;
    padding: 0.25rem 0.7rem;
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    cursor: pointer;
    transition: all 0.15s;
    border: 1px solid transparent;
  }
  .word-pill:hover {
    opacity: 0.8;
  }

  .tooltip {
    position: fixed;
    background: var(--ink);
    color: var(--bg);
    border-radius: 6px;
    padding: 0.5rem 0.8rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 100;
    white-space: nowrap;
  }
  .tooltip.visible { opacity: 1; }

  .type-area {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
  }

  .type-area textarea {
    width: 100%;
    padding: 0.8rem 1rem;
    border: 1px solid var(--line);
    border-radius: 8px;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.9rem;
    resize: vertical;
    background: white;
    color: var(--ink);
    min-height: 80px;
    transition: border-color 0.2s;
  }
  .type-area textarea:focus {
    outline: none;
    border-color: var(--accent2);
  }
  .type-area label {
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
  }
</style>
</head>
<body>

<div class="layout">
  <aside class="sidebar">
    <a href="index.html" class="nav-back">← Horizon v5</a>

    <div>
      <div class="eyebrow">Power Laws</div>
      <h1>Zipf's Law</h1>
      <p class="description">The second most common word appears half as often as the first. The third, a third as often. This isn't a quirk of English — it's a law that shows up in every language, every city, every fortune.</p>
    </div>

    <div class="formula-box">
      f(r) = <span class="highlight">C / r<sup>α</sup></span><br>
      <span class="comment">// rank r, frequency f</span><br>
      <span class="comment">// α ≈ 1 for natural language</span><br>
      <span class="comment">// C = freq of rank-1 word</span>
    </div>

    <div class="controls-section">
      <h3>Corpus</h3>
      <div class="corpus-buttons">
        <button class="corpus-btn active" onclick="loadCorpus('moby')">Moby Dick</button>
        <button class="corpus-btn" onclick="loadCorpus('genesis')">Genesis (KJV)</button>
        <button class="corpus-btn" onclick="loadCorpus('shakespeare')">Shakespeare Sonnets</button>
        <button class="corpus-btn" onclick="loadCorpus('news')">News Headlines</button>
      </div>
    </div>

    <div class="controls-section">
      <h3>Try your own text</h3>
      <div class="type-area">
        <label>Paste or type anything</label>
        <textarea id="custom-text" placeholder="The quick brown fox jumped over the lazy dog..."></textarea>
        <button class="corpus-btn" onclick="loadCustom()">Analyze →</button>
      </div>
    </div>

    <div class="insight-box">
      <div class="insight-label">The Reframe</div>
      <p>Zipf's Law means that the most common word in any text is not a quirk of style — it's a mathematical inevitability. Language, wealth, city sizes, and earthquake magnitudes all obey the same curve. Something deep in complexity itself generates this shape.</p>
    </div>
  </aside>

  <main class="main-area">
    <div>
      <div class="chart-header">
        <div class="chart-title">Frequency vs. Rank — <span id="corpus-name">Moby Dick</span></div>
        <div class="view-toggle">
          <button class="toggle-btn active" id="btn-log" onclick="setScale('log')">log–log</button>
          <button class="toggle-btn" id="btn-linear" onclick="setScale('linear')">linear</button>
        </div>
      </div>
      <canvas id="chart" width="800" height="420" style="margin-top:1rem; max-width:100%;"></canvas>
    </div>

    <div>
      <div class="chart-title" style="margin-bottom:0.8rem;">Top Words — click to highlight on chart</div>
      <div class="word-parade" id="word-parade"></div>
    </div>
  </main>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// Sample word frequency data (pre-computed counts, ranks 1-100)
const CORPORA = {
  moby: {
    name: 'Moby Dick',
    // Top 60 words with approximate frequencies from actual Moby Dick
    words: [
      ['the',14431],['of',6607],['and',6430],['a',4736],['to',4625],
      ['in',4172],['that',3085],['his',2530],['it',2522],['I',2127],
      ['he',2103],['was',1909],['with',1720],['is',1525],['at',1494],
      ['as',1461],['for',1363],['all',1261],['this',1238],['but',1234],
      ['not',1195],['had',1072],['from',1034],['be',978],['on',962],
      ['have',933],['him',896],['which',876],['by',873],['are',857],
      ['one',820],['so',804],['were',795],['when',779],['then',762],
      ['they',740],['now',719],['an',714],['like',691],['no',680],
      ['up',670],['ye',651],['what',640],['their',639],['its',631],
      ['out',614],['would',588],['who',570],['into',560],['old',549],
      ['more',541],['some',536],['upon',527],['there',524],['if',512],
      ['my',506],['or',497],['sea',494],['but',488],['do',480]
    ]
  },
  genesis: {
    name: 'Genesis (KJV)',
    words: [
      ['the',2575],['and',2230],['of',1360],['that',750],['unto',710],
      ['shall',670],['in',660],['a',640],['I',598],['his',570],
      ['said',542],['he',530],['them',512],['God',505],['thy',488],
      ['to',476],['with',455],['thou',443],['was',432],['all',414],
      ['LORD',402],['land',380],['out',362],['it',355],['which',342],
      ['be',338],['for',326],['son',315],['her',308],['my',298],
      ['not',290],['from',282],['Abraham',276],['these',265],['when',258],
      ['Jacob',252],['so',245],['they',240],['brought',235],['she',228],
      ['have',220],['Israel',215],['before',210],['an',205],['behold',200],
      ['us',195],['as',190],['Joseph',186],['upon',182],['but',178],
      ['by',175],['were',171],['their',167],['there',162],['every',158],
      ['gave',155],['earth',151],['set',148],['take',145],['day',142]
    ]
  },
  shakespeare: {
    name: 'Shakespeare Sonnets',
    words: [
      ['the',1347],['and',960],['of',744],['to',716],['in',527],
      ['my',501],['that',469],['thy',460],['a',440],['is',424],
      ['with',398],['I',392],['not',381],['thee',362],['thou',348],
      ['for',340],['be',328],['but',316],['love',308],['so',297],
      ['it',282],['when',275],['his',268],['time',264],['by',255],
      ['which',243],['from',238],['me',231],['as',225],['eye',219],
      ['beauty',212],['shall',206],['have',202],['your',197],['heart',192],
      ['yet',187],['will',183],['own',179],['are',174],['all',170],
      ['or',165],['more',161],['on',157],['fair',153],['this',149],
      ['self',145],['their',141],['do',137],['now',134],['him',130],
      ['were',127],['night',123],['day',120],['where',117],['they',114],
      ['then',111],['black',108],['rose',106],['sweet',103],['still',100]
    ]
  },
  news: {
    name: 'News Headlines',
    words: [
      ['the',8200],['to',5600],['a',4800],['of',4600],['in',4100],
      ['and',3900],['for',2800],['is',2600],['on',2400],['as',2200],
      ['at',2100],['says',1900],['new',1800],['with',1700],['after',1600],
      ['has',1550],['us',1500],['over',1440],['from',1380],['it',1320],
      ['by',1260],['be',1200],['its',1150],['are',1100],['that',1050],
      ['but',1000],['up',960],['than',920],['have',880],['amid',840],
      ['were',800],['his',765],['amid',730],['could',700],['he',670],
      ['amid',640],['would',615],['their',590],['more',565],['state',542],
      ['plan',520],['deal',499],['world',480],['amid',462],['poll',445],
      ['bill',430],['amid',415],['court',400],['amid',386],['house',372],
      ['report',359],['call',347],['amid',335],['law',325],['Trump',315],
      ['amid',306],['amid',298],['first',290],['amid',283],['year',275]
    ]
  }
};

let currentData = [];
let scaleMode = 'log';
let highlightedWord = null;
const chart = document.getElementById('chart');
const ctx2 = chart.getContext('2d');
const tooltip = document.getElementById('tooltip');

function loadCorpus(key) {
  const corp = CORPORA[key];
  document.getElementById('corpus-name').textContent = corp.name;
  document.querySelectorAll('.corpus-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  
  // Sort and rank
  currentData = corp.words
    .sort((a, b) => b[1] - a[1])
    .map((w, i) => ({ word: w[0], freq: w[1], rank: i + 1 }));
  
  highlightedWord = null;
  renderChart();
  renderWordParade();
}

function loadCustom() {
  const text = document.getElementById('custom-text').value;
  if (!text.trim()) return;
  
  const words = text.toLowerCase().match(/[a-z']+/g) || [];
  const counts = {};
  words.forEach(w => { counts[w] = (counts[w] || 0) + 1; });
  
  currentData = Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 60)
    .map((w, i) => ({ word: w[0], freq: w[1], rank: i + 1 }));
  
  document.getElementById('corpus-name').textContent = 'Custom Text';
  highlightedWord = null;
  renderChart();
  renderWordParade();
}

function setScale(mode) {
  scaleMode = mode;
  document.getElementById('btn-log').classList.toggle('active', mode === 'log');
  document.getElementById('btn-linear').classList.toggle('active', mode === 'linear');
  renderChart();
}

function renderChart() {
  const W = chart.width, H = chart.height;
  const pad = { top: 30, right: 40, bottom: 60, left: 70 };
  
  ctx2.clearRect(0, 0, W, H);
  
  if (currentData.length === 0) return;
  
  const ranks = currentData.map(d => d.rank);
  const freqs = currentData.map(d => d.freq);
  
  let xScale, yScale;
  
  if (scaleMode === 'log') {
    const minR = 1, maxR = ranks[ranks.length-1];
    const minF = Math.min(...freqs), maxF = Math.max(...freqs);
    xScale = r => pad.left + (Math.log(r) - Math.log(minR)) / (Math.log(maxR) - Math.log(minR)) * (W - pad.left - pad.right);
    yScale = f => H - pad.bottom - (Math.log(f) - Math.log(minF)) / (Math.log(maxF) - Math.log(minF)) * (H - pad.top - pad.bottom);
  } else {
    const maxR = ranks[ranks.length-1];
    const maxF = Math.max(...freqs);
    xScale = r => pad.left + (r - 1) / (maxR - 1) * (W - pad.left - pad.right);
    yScale = f => H - pad.bottom - f / maxF * (H - pad.top - pad.bottom);
  }

  // Grid
  ctx2.strokeStyle = '#e8e4dc';
  ctx2.lineWidth = 1;
  for (let i = 0; i <= 5; i++) {
    const y = pad.top + i * (H - pad.top - pad.bottom) / 5;
    ctx2.beginPath();
    ctx2.moveTo(pad.left, y);
    ctx2.lineTo(W - pad.right, y);
    ctx2.stroke();
  }

  // Zipf ideal line
  const idealFreq = currentData[0].freq;
  ctx2.beginPath();
  ctx2.strokeStyle = 'rgba(37, 99, 235, 0.35)';
  ctx2.lineWidth = 1.5;
  ctx2.setLineDash([6, 4]);
  let first = true;
  for (const d of currentData) {
    const idealF = idealFreq / d.rank;
    const x = xScale(d.rank), y = yScale(idealF);
    if (y < pad.top || y > H - pad.bottom) continue;
    if (first) { ctx2.moveTo(x, y); first = false; }
    else ctx2.lineTo(x, y);
  }
  ctx2.stroke();
  ctx2.setLineDash([]);

  // Zipf label
  ctx2.fillStyle = 'rgba(37, 99, 235, 0.6)';
  ctx2.font = '11px JetBrains Mono, monospace';
  ctx2.fillText('Zipf ideal (f ∝ 1/r)', xScale(3) + 8, yScale(idealFreq / 3) - 8);

  // Data points
  for (const d of currentData) {
    const x = xScale(d.rank);
    const y = yScale(d.freq);
    if (y < pad.top || y > H - pad.bottom) continue;
    
    const isHighlighted = d.word === highlightedWord;
    ctx2.beginPath();
    ctx2.arc(x, y, isHighlighted ? 6 : 4, 0, Math.PI * 2);
    ctx2.fillStyle = isHighlighted ? '#e63329' : 'rgba(26, 24, 20, 0.65)';
    ctx2.fill();

    if (d.rank <= 5 || isHighlighted) {
      ctx2.fillStyle = isHighlighted ? '#e63329' : '#1a1814';
      ctx2.font = `${isHighlighted ? 'bold ' : ''}11px JetBrains Mono, monospace`;
      ctx2.fillText(`"${d.word}"`, x + 7, y + 4);
    }
  }

  // Axes
  ctx2.fillStyle = '#8c8880';
  ctx2.font = '11px JetBrains Mono, monospace';
  ctx2.textAlign = 'center';
  ctx2.fillText(scaleMode === 'log' ? 'log(rank)' : 'rank', W/2, H - 10);
  
  ctx2.save();
  ctx2.translate(16, H/2);
  ctx2.rotate(-Math.PI/2);
  ctx2.fillText(scaleMode === 'log' ? 'log(freq)' : 'frequency', 0, 0);
  ctx2.restore();
  ctx2.textAlign = 'left';

  // Axis tick values
  ctx2.fillStyle = '#8c8880';
  ctx2.font = '10px JetBrains Mono, monospace';
  if (scaleMode === 'log') {
    [1, 5, 20, 60].forEach(r => {
      if (r <= currentData.length) {
        const x = xScale(r);
        ctx2.fillText(r, x - 6, H - pad.bottom + 16);
        ctx2.beginPath();
        ctx2.strokeStyle = '#d8d4cc';
        ctx2.lineWidth = 1;
        ctx2.moveTo(x, H - pad.bottom);
        ctx2.lineTo(x, H - pad.bottom + 4);
        ctx2.stroke();
      }
    });
  }
}

function renderWordParade() {
  const container = document.getElementById('word-parade');
  container.innerHTML = '';
  const maxFreq = currentData[0]?.freq || 1;
  
  currentData.slice(0, 50).forEach((d, i) => {
    const pill = document.createElement('div');
    pill.className = 'word-pill';
    const intensity = Math.pow(d.freq / maxFreq, 0.4);
    const r = Math.round(230 - intensity * 210);
    const g = Math.round(230 - intensity * 210);
    const b = Math.round(230 - intensity * 210);
    const textColor = intensity > 0.4 ? '#f2f0eb' : '#1a1814';
    pill.style.background = `rgb(${r},${g},${b})`;
    pill.style.color = textColor;
    pill.style.borderColor = `rgba(0,0,0,${intensity * 0.2})`;
    pill.textContent = d.word;
    pill.title = `rank ${d.rank}, freq ${d.freq.toLocaleString()}`;
    pill.onclick = () => {
      highlightedWord = highlightedWord === d.word ? null : d.word;
      renderChart();
      renderWordParade();
    };
    if (d.word === highlightedWord) {
      pill.style.background = '#e63329';
      pill.style.color = 'white';
      pill.style.borderColor = '#e63329';
    }
    container.appendChild(pill);
  });
}

// Mouse hover on chart
chart.addEventListener('mousemove', (e) => {
  const rect = chart.getBoundingClientRect();
  const mx = (e.clientX - rect.left) * (chart.width / rect.width);
  const my = (e.clientY - rect.top) * (chart.height / rect.height);
  const pad = { top: 30, right: 40, bottom: 60, left: 70 };
  
  let closest = null, minDist = 25;
  const maxR = currentData[currentData.length-1]?.rank || 1;
  const maxF = Math.max(...currentData.map(d => d.freq));
  
  for (const d of currentData) {
    let x, y;
    if (scaleMode === 'log') {
      x = pad.left + Math.log(d.rank) / Math.log(maxR) * (chart.width - pad.left - pad.right);
      y = chart.height - pad.bottom - Math.log(d.freq) / Math.log(maxF) * (chart.height - pad.top - pad.bottom);
    } else {
      x = pad.left + (d.rank - 1) / (maxR - 1) * (chart.width - pad.left - pad.right);
      y = chart.height - pad.bottom - d.freq / maxF * (chart.height - pad.top - pad.bottom);
    }
    const dist = Math.sqrt((mx-x)**2 + (my-y)**2);
    if (dist < minDist) { minDist = dist; closest = d; }
  }
  
  if (closest) {
    tooltip.textContent = `"${closest.word}" — rank #${closest.rank}, count: ${closest.freq.toLocaleString()}`;
    tooltip.style.left = (e.clientX + 12) + 'px';
    tooltip.style.top = (e.clientY - 28) + 'px';
    tooltip.classList.add('visible');
  } else {
    tooltip.classList.remove('visible');
  }
});
chart.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));

// Resize chart canvas
function resizeChart() {
  const container = chart.parentElement;
  const w = Math.min(container.clientWidth - 40, 900);
  chart.width = w;
  chart.height = Math.round(w * 0.52);
  renderChart();
}
window.addEventListener('resize', resizeChart);

// Init
loadCorpus('moby');
setTimeout(resizeChart, 100);
</script>
</body>
</html>
