<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Justin Hart + Go Forward Labs | AI Video Demo Reel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0a0f18; --line:#2a3750; --txt:#e8eefc; --muted:#9fb0ce; --gap:8px; --row:58px; }
    * { box-sizing:border-box; }
    body { margin:0; background:radial-gradient(1000px 500px at 90% -10%, rgba(105,210,255,.15), transparent), var(--bg); color:var(--txt); font-family:'IBM Plex Sans', sans-serif; }
    .wrap { max-width:1320px; margin:0 auto; padding:20px; }
    .top { display:flex; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:14px; }
    .top img { height:34px; width:auto; background:#fff; border-radius:6px; padding:4px; border:1px solid #2f4468; }
    .top a { color:#cfe7ff; text-decoration:none; font-weight:600; }
    h1 { font-family:Syne, sans-serif; font-size:clamp(1.6rem,3.5vw,2.4rem); margin:0 0 12px; }

    .mosaic {
      display:grid;
      grid-template-columns:repeat(12, 1fr);
      grid-auto-rows:var(--row);
      grid-auto-flow:dense;
      gap:var(--gap);
    }
    .tile { border:1px solid var(--line); border-radius:10px; overflow:hidden; background:#070b12; }
    .tile.featured { border-color:#4e658f; }
    .tile video { width:100%; height:100%; object-fit:contain; display:block; background:#05070c; }

    @media (max-width:1024px) { .mosaic { grid-template-columns:repeat(8,1fr); --row:52px; } }
    @media (max-width:680px) { .mosaic { grid-template-columns:repeat(4,1fr); --row:64px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="/" style="color:#9ec8ff;text-decoration:none">‚Üê Home</a>
    <div class="top">
      <strong>Justin Hart +</strong>
      <a href="https://goforwardlabs.com/" target="_blank" rel="noopener">
        <img src="https://goforwardlabs.com/wp-content/uploads/elementor/thumbs/goforwardlabs-logo-r6d19x35njgjivh7fr1xy4ksszi57gm4c2vr3xvb4w.png" alt="Go Forward Labs logo">
      </a>
      <a href="https://goforwardlabs.com/" target="_blank" rel="noopener">Go Forward Labs</a>
    </div>
    <h1>AI Video Demo Reel</h1>
    <section class="mosaic" id="mosaic"></section>
  </div>

  <script>
    const mosaic = document.getElementById('mosaic');

    function columnsForViewport() {
      if (window.innerWidth <= 680) return 4;
      if (window.innerWidth <= 1024) return 8;
      return 12;
    }

    function spanFromAR(ar, isFeatured=false) {
      const cols = columnsForViewport();
      if (isFeatured) return Math.min(cols, Math.max(4, Math.floor(cols * 0.66)));
      if (ar >= 1.9) return Math.min(cols, 6);
      if (ar >= 1.6) return Math.min(cols, 5);
      if (ar >= 1.3) return Math.min(cols, 4);
      if (ar >= 1.0) return Math.min(cols, 3);
      return Math.min(cols, 2);
    }

    function computeRowSpan(colSpan, ar) {
      const styles = getComputedStyle(mosaic);
      const gap = parseFloat(styles.gap || 8);
      const row = parseFloat(styles.gridAutoRows || 58);
      const cols = columnsForViewport();
      const tileWidth = (mosaic.clientWidth - gap * (cols - 1)) / cols * colSpan + gap * (colSpan - 1);
      const tileHeight = tileWidth / ar;
      return Math.max(2, Math.ceil((tileHeight + gap) / (row + gap)));
    }

    function tileHTML(src, poster, colSpan, rowSpan, featured=false) {
      return `<article class="tile ${featured ? 'featured' : ''}" style="grid-column: span ${colSpan}; grid-row: span ${rowSpan};">
        <video controls preload="metadata" poster="${poster}">
          <source src="${src}" type="application/x-mpegURL" />
          <source src="${src}" type="video/mp4" />
        </video>
      </article>`;
    }

    let data = null;

    function render() {
      if (!data) return;
      const { videos, featured } = data;
      const cards = [];

      const fCols = spanFromAR(featured.ar, true);
      const fRows = computeRowSpan(fCols, featured.ar);
      cards.push(tileHTML('./assets/featured-top.mp4', './assets/featured-top.jpg', fCols, fRows, true));

      videos.forEach(v => {
        const c = spanFromAR(v.ar, false);
        const r = computeRowSpan(c, v.ar);
        const src = v.uid ? `https://videodelivery.net/${v.uid}/manifest/video.m3u8` : `./assets/${v.slug}.mp4`;
        cards.push(tileHTML(src, `./assets/${v.slug}.jpg`, c, r, false));
      });

      mosaic.innerHTML = cards.join('');
    }

    Promise.all([
      fetch('./manifest.json').then(r => r.json()),
      fetch('./featured.json').then(r => r.json()),
      fetch('./stream-map.json').then(r => r.json()).catch(() => [])
    ]).then(([videos, featured, streamMap]) => {
      const uidByFilename = new Map(streamMap.map(x => [x.filename, x.uid]));
      videos = videos.map(v => ({ ...v, uid: uidByFilename.get(v.title) || null }));
      data = { videos, featured };
      render();
      window.addEventListener('resize', () => {
        clearTimeout(window.__mosaicResize);
        window.__mosaicResize = setTimeout(render, 120);
      });
    });
  </script>
</body>
</html>