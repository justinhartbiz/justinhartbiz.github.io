<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TLH Estate Sales ‚Äî By Sale Weekend</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Lato',system-ui,sans-serif;background:#f8f9fa;color:#0D3B66;padding:20px;min-height:100vh}
h1{font-size:1.5rem;font-weight:700;color:#0D3B66;margin-bottom:4px}
.sub{color:#6b7c8f;font-size:.85rem;margin-bottom:20px}
.card{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 12px rgba(0,0,0,.06);margin-bottom:20px}
.card h2{font-size:1.1rem;color:#0D3B66;margin-bottom:16px;padding-bottom:8px;border-bottom:2px solid #38B6B2}
.toggle-row{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;justify-content:center}
.toggle{padding:8px 20px;border-radius:20px;cursor:pointer;font-size:.85rem;font-weight:600;border:2px solid #e0e5ea;background:#fff;color:#6b7c8f;transition:.2s}
.toggle:hover{border-color:#38B6B2;color:#0D3B66}
.toggle.on{background:#38B6B2;color:#fff;border-color:#38B6B2}
.toggle.on-sd{background:#A47EAF;color:#fff;border-color:#A47EAF}
.toggle.on-all{background:#0D3B66;color:#fff;border-color:#0D3B66}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin:16px 0}
.stat{background:#f0f7f7;border-radius:10px;padding:14px;text-align:center;border:1px solid #e0eded}
.stat-num{font-size:1.6rem;font-weight:700}
.stat-label{font-size:.72rem;color:#6b7c8f;margin-top:2px}
.color-oc{color:#38B6B2}.color-sd{color:#A47EAF}.color-all{color:#0D3B66}.color-gold{color:#d4ac0d}
.yoy-table{width:100%;border-collapse:collapse}
.yoy-table th{text-align:center;padding:8px 6px;font-size:.75rem;color:#6b7c8f;border-bottom:2px solid #e0e5ea;font-weight:600}
.yoy-table th:first-child{text-align:left}
.yoy-table td{text-align:center;padding:8px 6px;font-size:.85rem;border-bottom:1px solid #f0f2f5}
.yoy-table td:first-child{text-align:left;font-weight:700;font-size:.9rem}
.yoy-table tr:last-child td{border-bottom:2px solid #e0e5ea;font-weight:700}
.cell-hot{background:#e8f8f5;font-weight:700;color:#38B6B2}
.cell-peak{background:#fef9e7;font-weight:700;color:#d4ac0d}
.cell-zero{color:#ccc}
.row-year{background:#f8f9fa}
.row-total{background:#eef6f6}
.yoy-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:.7rem;font-weight:700;margin-left:4px}
.yoy-up{background:#e8f8f5;color:#27ae60}
.yoy-down{background:#fdecea;color:#e74c3c}
.note{background:#f0f7f7;border:1px solid #d1eceb;border-radius:8px;padding:12px 16px;font-size:.82rem;color:#0D3B66;margin:12px 0}
.note strong{color:#38B6B2}
.bar-row{display:flex;align-items:flex-end;gap:3px;height:200px;padding:0 2px;border-bottom:2px solid #e0e5ea}
.bar-col{flex:1;display:flex;flex-direction:column;align-items:center}
.bar-val{font-size:.6rem;font-weight:700;color:#0D3B66;margin-bottom:1px}
.bar{width:75%;border-radius:3px 3px 0 0;transition:.3s;cursor:pointer}
.bar:hover{filter:brightness(1.1)}
.label-row{display:flex;gap:3px;padding:0 2px;margin-top:3px}
.label-col{flex:1;text-align:center;font-size:.55rem;color:#6b7c8f}
.yr-legend{display:flex;gap:12px;justify-content:center;margin:8px 0;font-size:.75rem}
.yr-legend span{display:flex;align-items:center;gap:4px}
.yr-dot{width:10px;height:10px;border-radius:3px}
</style>
</head>
<body>

<h1>üè† TLH Estate Sales ‚Äî By Sale Weekend</h1>
<p class="sub">Grouped by <strong>Estate Sale Weekend</strong> ‚Ä¢ Closed Won ‚Ä¢ Jun 2024 ‚Äî Mar 2026</p>

<div class="toggle-row">
<div class="toggle on-all" data-v="all" onclick="setView('all',this)">All Markets</div>
<div class="toggle" data-v="oc_la" onclick="setView('oc_la',this)">üçä OC + LA</div>
<div class="toggle" data-v="sd" onclick="setView('sd',this)">üåä San Diego</div>
</div>

<div class="stats-grid" id="stats"></div>

<div class="card">
<h2 id="tbl-title">üìä Year-over-Year by Month</h2>
<div style="overflow-x:auto">
<table class="yoy-table" id="yoy"></table>
</div>
</div>

<div class="card">
<h2 id="chart-title">üìà Monthly Trend ‚Äî Overlay by Year</h2>
<div class="yr-legend" id="yr-legend"></div>
<div class="bar-row" id="bars"></div>
<div class="label-row" id="labels"></div>
</div>

<div class="note" id="insight"></div>

<script>
const raw = [
{"m":"2024-06","oc":2,"sd":7,"la":0},{"m":"2024-07","oc":1,"sd":7,"la":0},
{"m":"2024-08","oc":4,"sd":8,"la":0},{"m":"2024-09","oc":1,"sd":11,"la":0},
{"m":"2024-10","oc":2,"sd":10,"la":1},{"m":"2024-11","oc":2,"sd":9,"la":0},
{"m":"2024-12","oc":3,"sd":8,"la":1},{"m":"2025-01","oc":2,"sd":11,"la":2},
{"m":"2025-02","oc":4,"sd":9,"la":0},{"m":"2025-03","oc":3,"sd":8,"la":1},
{"m":"2025-04","oc":2,"sd":11,"la":2},{"m":"2025-05","oc":4,"sd":11,"la":0},
{"m":"2025-06","oc":4,"sd":11,"la":0},{"m":"2025-07","oc":3,"sd":12,"la":1},
{"m":"2025-08","oc":6,"sd":15,"la":2},{"m":"2025-09","oc":7,"sd":13,"la":0},
{"m":"2025-10","oc":5,"sd":12,"la":2},{"m":"2025-11","oc":2,"sd":11,"la":1},
{"m":"2025-12","oc":0,"sd":7,"la":5},{"m":"2026-01","oc":1,"sd":9,"la":4},
{"m":"2026-02","oc":1,"sd":8,"la":2},{"m":"2026-03","oc":0,"sd":2,"la":0}
];

// Add oc_la combined
raw.forEach(d => d.oc_la = d.oc + d.la);

const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const monthNums = {'01':0,'02':1,'03':2,'04':3,'05':4,'06':5,'07':6,'08':7,'09':8,'10':9,'11':10,'12':11};

// Build year‚Üímonth grid
function buildGrid(key){
  const grid = {}; // year ‚Üí [12 months]
  raw.forEach(d => {
    const [y,mo] = d.m.split('-');
    if(!grid[y]) grid[y] = new Array(12).fill(0);
    grid[y][monthNums[mo]] = d[key];
  });
  return grid;
}

let currentView = 'all';

function setView(v, btn){
  currentView = v;
  document.querySelectorAll('.toggle').forEach(t => t.className = 'toggle');
  if(v==='all') btn.className = 'toggle on-all';
  else if(v==='sd') btn.className = 'toggle on-sd';
  else btn.className = 'toggle on';
  render();
}

function render(){
  const v = currentView;
  const key = v === 'all' ? null : v; // null = sum all
  
  // Build grids
  let grid;
  if(v === 'all'){
    grid = {};
    raw.forEach(d => {
      const [y,mo] = d.m.split('-');
      if(!grid[y]) grid[y] = new Array(12).fill(0);
      grid[y][monthNums[mo]] = d.oc + d.sd + d.la;
    });
  } else {
    grid = buildGrid(v);
  }
  
  const years = Object.keys(grid).sort();
  const names = {all:'All Markets', oc_la:'OC + LA Combined', sd:'San Diego'};
  const colors = {all:'#0D3B66', oc_la:'#38B6B2', sd:'#A47EAF'};
  const yearColors = {'2024':'#A47EAF','2025':'#38B6B2','2026':'#0D3B66'};
  
  // Stats
  const statsEl = document.getElementById('stats');
  const yearTotals = {};
  years.forEach(y => yearTotals[y] = grid[y].reduce((a,b)=>a+b,0));
  const grandTotal = Object.values(yearTotals).reduce((a,b)=>a+b,0);
  
  let statsHtml = '';
  years.forEach(y => {
    const partial = (y==='2024' || y==='2026') ? ' (partial)' : '';
    statsHtml += `<div class="stat"><div class="stat-num" style="color:${yearColors[y]}">${yearTotals[y]}</div><div class="stat-label">${y} Total${partial}</div></div>`;
  });
  
  // YoY for comparable months (Jul-Dec)
  if(yearTotals['2024'] && yearTotals['2025']){
    const h2_24 = grid['2024'].slice(5,12).reduce((a,b)=>a+b,0); // Jun-Dec (what we have)
    const h2_25 = grid['2025'].slice(5,12).reduce((a,b)=>a+b,0);
    const pct = h2_24>0 ? Math.round((h2_25-h2_24)/h2_24*100) : 0;
    const sign = pct>=0?'+':'';
    statsHtml += `<div class="stat"><div class="stat-num" style="color:${pct>=0?'#27ae60':'#e74c3c'}">${sign}${pct}%</div><div class="stat-label">Jun-Dec YoY</div></div>`;
  }
  
  statsHtml += `<div class="stat"><div class="stat-num color-gold">${grandTotal}</div><div class="stat-label">Grand Total</div></div>`;
  statsEl.innerHTML = statsHtml;
  
  // YoY Table ‚Äî years as rows, months as columns
  const tbl = document.getElementById('yoy');
  document.getElementById('tbl-title').textContent = 'üìä Year-over-Year ‚Äî ' + names[v];
  
  let html = '<tr><th></th>';
  months.forEach(m => html += `<th>${m}</th>`);
  html += '<th>Total</th></tr>';
  
  // Find peak value for highlighting
  const allVals = [];
  years.forEach(y => grid[y].forEach(v => { if(v>0) allVals.push(v); }));
  const peak = Math.max(...allVals);
  const p75 = allVals.sort((a,b)=>b-a)[Math.floor(allVals.length*0.25)] || 5;
  
  years.forEach(y => {
    const total = yearTotals[y];
    html += `<tr class="row-year"><td style="color:${yearColors[y]}">${y}</td>`;
    grid[y].forEach((val, mi) => {
      let cls = '';
      if(val === 0) cls = 'cell-zero';
      else if(val >= p75) cls = 'cell-peak';
      else if(val >= Math.ceil(p75*0.7)) cls = 'cell-hot';
      html += `<td class="${cls}">${val||'‚Äî'}</td>`;
    });
    html += `<td style="font-weight:700;color:${yearColors[y]}">${total}</td></tr>`;
  });
  
  // Delta row (2025 vs 2024)
  if(grid['2024'] && grid['2025']){
    html += '<tr class="row-total"><td>Œî 25 vs 24</td>';
    let deltaTotal = 0;
    for(let i=0;i<12;i++){
      const v24 = grid['2024'][i];
      const v25 = grid['2025'][i];
      if(v24===0 && v25===0){
        html += '<td class="cell-zero">‚Äî</td>';
      } else {
        const d = v25-v24;
        deltaTotal += d;
        const color = d>0?'#27ae60':d<0?'#e74c3c':'#6b7c8f';
        const sign = d>0?'+':'';
        html += `<td style="color:${color};font-weight:600">${sign}${d}</td>`;
      }
    }
    const dtColor = deltaTotal>0?'#27ae60':'#e74c3c';
    const dtSign = deltaTotal>0?'+':'';
    html += `<td style="color:${dtColor};font-weight:700">${dtSign}${deltaTotal}</td></tr>`;
  }
  
  tbl.innerHTML = html;
  
  // Bar chart ‚Äî overlay years by month
  const barsEl = document.getElementById('bars');
  const labelsEl = document.getElementById('labels');
  const legendEl = document.getElementById('yr-legend');
  document.getElementById('chart-title').textContent = 'üìà Monthly Overlay ‚Äî ' + names[v];
  
  barsEl.innerHTML = '';
  labelsEl.innerHTML = '';
  
  legendEl.innerHTML = years.map(y => 
    `<span><div class="yr-dot" style="background:${yearColors[y]}"></div>${y}</span>`
  ).join('');
  
  const maxBar = peak;
  
  // For each month, show side-by-side bars for each year
  for(let mi=0;mi<12;mi++){
    const col = document.createElement('div');
    col.className = 'bar-col';
    let inner = '';
    const hasData = years.some(y => grid[y][mi]>0);
    if(hasData){
      inner += '<div style="display:flex;gap:2px;align-items:flex-end;width:100%;height:200px;justify-content:center">';
      years.forEach(y => {
        const val = grid[y][mi];
        const h = val>0?(val/maxBar)*180:0;
        inner += `<div style="display:flex;flex-direction:column;align-items:center;flex:1">`;
        if(val>0) inner += `<div style="font-size:.55rem;font-weight:700;color:${yearColors[y]}">${val}</div>`;
        inner += `<div style="width:90%;height:${h}px;background:${yearColors[y]};border-radius:2px 2px 0 0;opacity:.85"></div>`;
        inner += '</div>';
      });
      inner += '</div>';
    }
    col.innerHTML = inner;
    barsEl.appendChild(col);
    
    const lbl = document.createElement('div');
    lbl.className = 'label-col';
    lbl.textContent = months[mi];
    labelsEl.appendChild(lbl);
  }
  
  // Insight
  const insightEl = document.getElementById('insight');
  if(v==='oc_la'){
    insightEl.innerHTML = `<strong>üìà OC+LA combined:</strong> Growing from 2-3/mo in mid-2024 to 5-8/mo in H2 2025. LA's growth is additive ‚Äî not cannibalizing OC. Together they're becoming a meaningful second market at ~30% of SD volume. Dec 2025's 5 LA sales show the expansion is real.`;
  } else if(v==='sd'){
    insightEl.innerHTML = `<strong>üìà San Diego:</strong> The engine. Consistently 8-15 sales/month. Aug 2025 peak at 15. Very stable ‚Äî the YoY delta shows where SD is gaining or losing ground month by month.`;
  } else {
    insightEl.innerHTML = `<strong>üìà All markets combined:</strong> Clear growth trajectory. H2 2025 outpaced H2 2024 driven by both OC/LA expansion and SD consistency. Aug 2025 (23 total) was the all-time peak. Use the toggle to drill into each market.`;
  }
}

render();
</script>
</body>
</html>
