<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TLH Scout â€” Partner Top 20</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{--teal:#38B6B2;--purple:#A47EAF;--navy:#0D3B66;--light:#F8F9FA;--line:#E5E5E5;--muted:#6B6B78}
  :root{--status-new:#3b82f6;--status-t1:#f59e0b;--status-t2:#f97316;--status-t3:#8b5cf6;--status-partner:#16a34a;--status-pass:#6b7280}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--light);color:#333;font-family:Lato,sans-serif}
  .top{background:var(--navy);color:#fff;padding:14px 22px}
  .top-row{max-width:1320px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .top h1{font-size:1.4rem;font-weight:900;margin:0}
  .top-sub{color:#c6d5ea;font-size:.82rem;margin-top:2px}
  .top-links a{color:#aee6e4;text-decoration:none;font-size:.8rem;margin-left:12px}
  .wrap{max-width:1320px;margin:0 auto;padding:20px}

  .score-box{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px 18px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
  .score-box h3{font-size:.72rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-bottom:10px;font-weight:700}
  .score-factors{display:flex;flex-wrap:wrap;gap:8px}
  .factor{display:flex;align-items:center;gap:8px;background:var(--light);border:1px solid var(--line);border-radius:8px;padding:8px 12px;font-size:.8rem;flex:1;min-width:200px}
  .fbar{width:5px;height:32px;border-radius:3px;flex-shrink:0}
  .fbar-navy{background:var(--navy)}.fbar-teal{background:var(--teal)}.fbar-purple{background:var(--purple)}.fbar-gold{background:#f59e0b}
  .fpts{font-weight:900;font-size:1.1rem;color:var(--navy);min-width:28px}
  .fdesc strong{display:block;font-size:.78rem;font-weight:700;color:#222}
  .fdesc span{font-size:.7rem;color:var(--muted);line-height:1.4;display:block;margin-top:1px}

  /* Campaign Console */
  .campaign-console{background:var(--navy);border-radius:10px;padding:12px 18px;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;box-shadow:0 3px 12px rgba(13,59,102,.25)}
  .cc-left{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .cc-right{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .cc-label{color:#aee6e4;font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-right:2px}
  .cc-select{background:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:.8rem;font-family:Lato;font-weight:600;color:var(--navy);cursor:pointer;min-width:140px}
  .cc-select:focus{outline:2px solid var(--teal);outline-offset:1px}
  .selected-count{background:rgba(56,182,178,.2);color:#fff;border-radius:20px;padding:6px 14px;font-size:.8rem;font-weight:700}
  .cc-checkbox{display:flex;align-items:center;gap:6px;color:#fff;font-size:.8rem;cursor:pointer}
  .cc-checkbox input{width:16px;height:16px;cursor:pointer}
  .btn-email{background:var(--teal);color:#fff;border:none;border-radius:8px;padding:9px 18px;font-size:.85rem;font-weight:700;font-family:Lato;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .15s}
  .btn-email:hover{background:#2fa8a3;transform:translateY(-1px);box-shadow:0 4px 10px rgba(56,182,178,.35)}
  .btn-postcard{background:#4a5568;color:#cbd5e0;border:none;border-radius:8px;padding:9px 18px;font-size:.85rem;font-weight:700;font-family:Lato;cursor:not-allowed;display:flex;align-items:center;gap:6px;position:relative}
  .btn-postcard::after{content:"ğŸ”’";font-size:.7rem;margin-left:2px}

  /* City Switcher */
  .city-switcher{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
  .city-btn{padding:12px 24px;border-radius:8px;border:2px solid var(--navy);background:#fff;cursor:pointer;font-weight:700;font-size:.9rem;color:var(--navy);transition:all .15s;font-family:Lato,sans-serif}
  .city-btn.active{background:var(--teal);color:#fff;border-color:var(--teal)}
  .city-btn:hover:not(.active){background:var(--navy);color:#fff;border-color:var(--navy)}

  .tabs{display:flex;gap:6px;margin-bottom:0;flex-wrap:wrap}
  .tab{padding:9px 18px;border-radius:10px 10px 0 0;border:1px solid var(--line);border-bottom:none;background:#fff;cursor:pointer;font-weight:700;font-size:.82rem;color:var(--muted);transition:all .15s;font-family:Lato,sans-serif}
  .tab.active{background:var(--navy);color:#fff;border-color:var(--navy)}
  .tab:hover:not(.active){color:var(--navy);border-color:var(--teal)}

  .panel{display:none;background:#fff;border:1px solid var(--line);border-radius:0 12px 12px 12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.06)}
  .panel.active{display:block}

  .stats-bar{display:flex;border-bottom:1px solid var(--line)}
  .stat{padding:11px 16px;flex:1;border-right:1px solid var(--line);text-align:center}
  .stat:last-child{border-right:none}
  .stat-num{font-size:1.3rem;font-weight:900;color:var(--navy)}
  .stat-lbl{font-size:.65rem;text-transform:uppercase;letter-spacing:.4px;color:var(--muted);margin-top:1px}

  table{width:100%;border-collapse:collapse;font-size:.8rem}
  th{background:#f1f5f9;color:#475569;font-size:.67rem;text-transform:uppercase;letter-spacing:.5px;padding:9px 12px;text-align:left;border-bottom:1px solid var(--line);font-family:Lato,sans-serif;font-weight:700}
  td{padding:10px 12px;border-bottom:1px solid #f1f5f9;vertical-align:middle}
  tr:last-child td{border-bottom:none}
  tr:hover td{background:#f8fbff}
  tr.selected td{background:rgba(56,182,178,0.08)}

  .row-checkbox{width:18px;height:18px;cursor:pointer}
  
  .rank-num{font-weight:900;font-size:1rem;color:var(--navy);text-align:center;white-space:nowrap}
  .score-cell{display:flex;align-items:center;gap:7px}
  .score-bg{flex:1;background:var(--line);border-radius:4px;height:7px;min-width:40px}
  .score-fill{height:7px;border-radius:4px}
  .s-high{background:var(--teal)}.s-mid{background:#f59e0b}.s-low{background:#ef4444}
  .score-val{font-weight:900;font-size:.82rem;min-width:22px}

  .firm-name{font-weight:700;font-size:.88rem;color:#1e293b}
  .firm-sub{font-size:.7rem;color:var(--teal);font-weight:700;margin-top:1px}
  .firm-addr{font-size:.73rem;color:#475569;margin-top:3px;line-height:1.45}
  .firm-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

  .rpill{display:inline-flex;align-items:center;gap:3px;font-size:.74rem;font-weight:700;color:#92400e;background:#fef3c7;border:1px solid #fcd34d;border-radius:20px;padding:2px 8px;white-space:nowrap}
  .kws{display:flex;flex-wrap:wrap;gap:3px}
  .kw{background:#dbeafe;color:#1d4ed8;border-radius:10px;padding:1px 7px;font-size:.65rem;font-weight:700}

  .contact{font-size:.75rem;line-height:1.8}
  .contact a{color:var(--navy);text-decoration:none;font-weight:600}
  .contact a:hover{color:var(--teal)}
  .predicted{color:var(--purple);font-style:italic;font-size:.7rem}

  .new-tag{background:rgba(56,182,178,.12);color:#0e7f7b;border:1px solid var(--teal);border-radius:10px;padding:1px 7px;font-size:.65rem;font-weight:700;margin-left:4px}
  
  .city-view{display:none}
  .city-view.active{display:block}

  /* Status Pill */
  .status-pill{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:12px;font-size:.68rem;font-weight:700;cursor:pointer;transition:all .15s;border:1px solid transparent}
  .status-pill:hover{transform:scale(1.05);box-shadow:0 2px 6px rgba(0,0,0,.15)}
  .status-pill.s-new{background:#dbeafe;color:#1d4ed8;border-color:#3b82f6}
  .status-pill.s-touch1{background:#fef3c7;color:#b45309;border-color:#f59e0b}
  .status-pill.s-touch2{background:#ffedd5;color:#c2410c;border-color:#f97316}
  .status-pill.s-touch3{background:#ede9fe;color:#6d28d9;border-color:#8b5cf6}
  .status-pill.s-partner{background:#dcfce7;color:#15803d;border-color:#16a34a}
  .status-pill.s-pass{background:#f3f4f6;color:#4b5563;border-color:#6b7280}
  .status-dot{width:6px;height:6px;border-radius:50%;background:currentColor}

  /* Status Dropdown Popover */
  .status-dropdown{position:absolute;z-index:100;background:#fff;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.2);padding:6px;min-width:140px;display:none}
  .status-dropdown.show{display:block}
  .status-option{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:6px;cursor:pointer;font-size:.78rem;font-weight:600;transition:all .1s}
  .status-option:hover{background:#f1f5f9}
  .status-option .status-dot{width:8px;height:8px;border-radius:50%}
  .status-option .sd-new{background:var(--status-new)}
  .status-option .sd-t1{background:var(--status-t1)}
  .status-option .sd-t2{background:var(--status-t2)}
  .status-option .sd-t3{background:var(--status-t3)}
  .status-option .sd-partner{background:var(--status-partner)}
  .status-option .sd-pass{background:var(--status-pass)}

  /* Modal */
  .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:1000;align-items:center;justify-content:center;padding:20px}
  .modal-overlay.active{display:flex}
  .modal{background:#fff;border-radius:16px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
  .modal-header{background:var(--navy);color:#fff;padding:20px 24px;border-radius:16px 16px 0 0;display:flex;justify-content:space-between;align-items:center}
  .modal-header h2{font-size:1.2rem;font-weight:900}
  .modal-close{background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;padding:0;line-height:1}
  .modal-body{padding:24px}
  .modal-template{background:rgba(56,182,178,.1);border:1px solid var(--teal);border-radius:10px;padding:14px;margin-bottom:18px}
  .modal-template-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);font-weight:700;margin-bottom:4px}
  .modal-template-name{font-weight:700;color:var(--navy);font-size:1rem}
  .modal-firms{background:#f8f9fa;border-radius:10px;padding:14px;margin-bottom:18px;max-height:150px;overflow-y:auto}
  .modal-firm{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee;font-size:.85rem}
  .modal-firm:last-child{border-bottom:none}
  .modal-firm-name{font-weight:600;color:#333}
  .modal-firm-email{color:var(--muted)}
  .form-group{margin-bottom:16px}
  .form-label{display:block;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);font-weight:700;margin-bottom:6px}
  .form-input{width:100%;border:1px solid var(--line);border-radius:8px;padding:10px 14px;font-size:.9rem;font-family:Lato}
  .form-input:focus{outline:2px solid var(--teal);outline-offset:1px;border-color:var(--teal)}
  .form-textarea{width:100%;border:1px solid var(--line);border-radius:8px;padding:10px 14px;font-size:.85rem;font-family:Lato;min-height:180px;resize:vertical;line-height:1.5}
  .form-textarea:focus{outline:2px solid var(--teal);outline-offset:1px;border-color:var(--teal)}
  .modal-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px}
  .btn-primary{background:var(--teal);color:#fff;border:none;border-radius:8px;padding:12px 24px;font-size:.9rem;font-weight:700;font-family:Lato;cursor:pointer;flex:1;min-width:140px}
  .btn-primary:hover{background:#2fa8a3}
  .btn-secondary{background:#fff;color:var(--navy);border:2px solid var(--navy);border-radius:8px;padding:12px 24px;font-size:.9rem;font-weight:700;font-family:Lato;cursor:pointer;flex:1;min-width:140px}
  .btn-secondary:hover{background:var(--navy);color:#fff}
  .btn-cancel{background:#e2e8f0;color:#475569;border:none;border-radius:8px;padding:12px 24px;font-size:.9rem;font-weight:700;font-family:Lato;cursor:pointer}
  .btn-cancel:hover{background:#cbd5e1}
  .btn-log{background:var(--purple);color:#fff;border:none;border-radius:8px;padding:12px 24px;font-size:.9rem;font-weight:700;font-family:Lato;cursor:pointer}
  .btn-log:hover{background:#8e6a98}

  .tooltip{position:relative}
  .tooltip::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#333;color:#fff;font-size:.7rem;padding:4px 8px;border-radius:4px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .2s;margin-bottom:5px}
  .tooltip:hover::after{opacity:1}

  /* Archive Section */
  .archive-section{margin-bottom:24px}
  .archive-header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-radius:10px 10px 0 0;font-weight:700;font-size:.85rem}
  .archive-header.partners{background:#dcfce7;color:#15803d;border:1px solid #86efac}
  .archive-header.passes{background:#f3f4f6;color:#4b5563;border:1px solid #d1d5db}
  .archive-table{width:100%;border-collapse:collapse}
  .archive-table th{background:#f8f9fa;font-size:.65rem}
  .archive-table td{padding:10px 14px;font-size:.8rem}
  .archive-table .firm-col{min-width:200px}
  .archive-table .notes-col{width:100%}
  .archive-table .action-col{white-space:nowrap}
  .inline-notes{border:1px solid var(--line);border-radius:6px;padding:6px 10px;font-size:.75rem;width:100%;font-family:Lato}
  .inline-notes:focus{outline:2px solid var(--teal);border-color:var(--teal)}
  .inline-reason{border:1px solid var(--line);border-radius:6px;padding:6px 10px;font-size:.75rem;width:100%;font-family:Lato}
  .inline-reason:focus{outline:2px solid var(--teal);border-color:var(--teal)}
  .btn-restore{background:var(--status-new);color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:.72rem;font-weight:700;cursor:pointer}
  .btn-restore:hover{background:#2563eb}

  /* Queue Tab */
  .queue-stats{display:flex;gap:16px;padding:14px 18px;background:#fff;border-bottom:1px solid var(--line);flex-wrap:wrap}
  .queue-stat{display:flex;align-items:center;gap:8px}
  .queue-stat-num{font-size:1.2rem;font-weight:900}
  .queue-stat-num.overdue{color:#ef4444}
  .queue-stat-num.new{color:var(--status-new)}
  .queue-stat-num.recent{color:#f59e0b}
  .queue-stat-label{font-size:.7rem;color:var(--muted);text-transform:uppercase}
  .queue-table th{white-space:nowrap}
  .queue-table .priority-col{width:80px}
  .queue-table .firm-col{min-width:180px}
  .queue-table .city-col{width:90px}
  .queue-table .type-col{width:90px}
  .queue-table .score-col{width:70px}
  .queue-table .status-col{width:90px}
  .queue-table .last-touch-col{width:100px}
  .queue-table .action-col{min-width:140px}
  .priority-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:6px;font-size:.68rem;font-weight:700}
  .priority-badge.overdue{background:#fee2e2;color:#dc2626}
  .priority-badge.is-new{background:#dbeafe;color:#1d4ed8}
  .priority-badge.recent{background:#fef3c7;color:#b45309}
  .action-text{font-size:.72rem;color:var(--muted)}
  .action-text urgent{color:#dc2626;font-weight:700}

  /* Archive Tab Specific */
  .archive-stats{display:flex;gap:16px;padding:14px 18px;background:#fff;border-bottom:1px solid var(--line);flex-wrap:wrap}
  .archive-stat{display:flex;align-items:center;gap:8px}
  .archive-stat-num{font-size:1.2rem;font-weight:900}
  .archive-stat-num.partners{color:var(--status-partner)}
  .archive-stat-num.passes{color:var(--status-pass)}

  /* Show filter in console */
  .cc-show-filter{display:flex;align-items:center;gap:6px}
  .cc-show-filter label{color:#aee6e4;font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
  .cc-show-filter select{background:#fff;border:none;border-radius:6px;padding:8px 12px;font-size:.8rem;font-family:Lato;font-weight:600;color:var(--navy);cursor:pointer;min-width:100px}

  /* Row visibility for filters */
  tr.hidden-by-filter{display:none !important}
</style>
</head>
<body>

<header class="top">
  <div class="top-row">
    <div style="display:flex;align-items:center;gap:12px">
      <img src="https://www.truelegacyhomes.com/wp-content/uploads/2022/10/tlhLOGO.png" alt="TLH" style="height:34px;filter:brightness(0) invert(1);opacity:.95">
      <div><h1>Scout â€” Partner Top 20</h1><div class="top-sub">San Diego + Orange County/Irvine Â· Estate Attorneys Â· Elder Law Â· Fiduciaries Â· Assisted Living Â· Feb 20, 2026</div></div>
    </div>
    <div class="top-links"><a href="/tlh/agents/">Agent OS</a><a href="/tlh/">TLH Hub</a></div>
  </div>
</header>

<div class="wrap">

  <div class="score-box">
    <h3>ğŸ“Š How Firms Are Scored (0â€“100 points)</h3>
    <div class="score-factors">
      <div class="factor"><div class="fbar fbar-navy"></div><div class="fpts">25</div><div class="fdesc"><strong>Google Rating</strong><span>4.5+ = 25 Â· 4.0 = 20 Â· 3.5 = 10 Â· 3.0 = 5</span></div></div>
      <div class="factor"><div class="fbar fbar-teal"></div><div class="fpts">25</div><div class="fdesc"><strong>Review Count</strong><span>100+ = 25 Â· 50+ = 20 Â· 25+ = 15 Â· 10+ = 10</span></div></div>
      <div class="factor"><div class="fbar fbar-purple"></div><div class="fpts">30</div><div class="fdesc"><strong>Website Keywords</strong><span>5 pts each: probate Â· estate Â· senior Â· trust Â· elder Â· downsizing Â· fiduciary</span></div></div>
      <div class="factor"><div class="fbar fbar-gold"></div><div class="fpts">20</div><div class="fdesc"><strong>Proximity</strong><span>SD: &lt;10km = 20 Â· OC: &lt;10km = 20</span></div></div>
    </div>
  </div>

  <!-- Campaign Console -->
  <div class="campaign-console">
    <div class="cc-left">
      <span class="cc-label">Template:</span>
      <select class="cc-select" id="templateSelect" onchange="updateTemplatePreview()">
        <option value="touch1">Intro Letter â€” Touch 1</option>
        <option value="touch2">Follow-up Postcard â€” Touch 2</option>
        <option value="touch3">Partner Invite â€” Touch 3</option>
      </select>
      <span class="cc-label">Status:</span>
      <select class="cc-select" id="statusFilter" onchange="filterTable()">
        <option value="all">All</option>
        <option value="new">New</option>
        <option value="contacted">Contacted</option>
        <option value="responded">Responded</option>
        <option value="partner">Partner</option>
        <option value="pass">Pass</option>
      </select>
      <span class="cc-label">City:</span>
      <select class="cc-select" id="cityFilter" onchange="filterTable()">
        <option value="all">All</option>
        <option value="sd">San Diego</option>
        <option value="oc">Orange County</option>
      </select>
      <div class="cc-show-filter">
        <label>Show:</label>
        <select id="showFilter" onchange="filterTable()">
          <option value="all">All</option>
          <option value="active">Active</option>
          <option value="archive">Archive</option>
        </select>
      </div>
    </div>
    <div class="cc-right">
      <div class="selected-count" id="selectedCount">0 firms selected</div>
      <label class="cc-checkbox">
        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
        â˜ Select All (filtered)
      </label>
      <button class="btn-email" onclick="openEmailModal()">ğŸ“§ Send Email to Selected</button>
      <button class="btn-postcard tooltip" data-tooltip="Coming soon â€” Lob integration pending">ğŸ“¬ Send Postcard to Selected</button>
    </div>
  </div>

  <!-- City Switcher -->
  <div class="city-switcher">
    <button class="city-btn active" onclick="showCity('sd',this)">ğŸ“ San Diego</button>
    <button class="city-btn" onclick="showCity('oc',this)">ğŸ“ Orange County / Irvine</button>
  </div>

  <!-- San Diego View -->
  <div class="city-view active" id="city-sd">
    <div class="tabs">
      <button class="tab active" onclick="showTab('sd','estate',this)">âš–ï¸ Estate Attorneys</button>
      <button class="tab" onclick="showTab('sd','elder',this)">ğŸ‘´ Elder Law</button>
      <button class="tab" onclick="showTab('sd','fiduciary',this)">ğŸ¦ Fiduciaries</button>
      <button class="tab" onclick="showTab('sd','assisted',this)">ğŸ  Assisted Living</button>
      <button class="tab" onclick="showTab('sd','queue',this)">ğŸ“‹ Queue</button>
      <button class="tab" onclick="showTab('sd','archive',this)">ğŸ—‚ Archive</button>
    </div>

    <!-- SD Estate Attorneys -->
    <div class="panel active" id="sd-panel-estate">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">20</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">100</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">217</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'sd-panel-estate')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="sd" data-type="estate">
          <tr data-firm="San Diego Probate Attorneys" data-email="info@sandiegoprobateattorneys.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:100%"></div></div><span class="score-val">100</span></div></td><td><div class="firm-row"><span class="firm-name">San Diego Probate Attorneys</span></div><div class="firm-addr">ğŸ“ 4445 Eastgate Mall #200, San Diego, CA 92121</div></td><td><span class="rpill">â˜… 4.9 Â· 110</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">senior</span></div></td><td><div class="contact"><a href="tel:+18583338877">858-333-8877</a><br><a href="https://www.sandiegoprobateattorneys.com" target="_blank">sandiegoprobateattorneys.com</a><br><span class="predicted">info@sandiegoprobateattorneys.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="San Diego Probate Law" data-email="info@sandiegoprobatelaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥ˆ 2</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:85%"></div></div><span class="score-val">85</span></div></td><td><div class="firm-row"><span class="firm-name">San Diego Probate Law</span></div><div class="firm-addr">ğŸ“ 3914 Murphy Canyon Rd, San Diego, CA 92123</div></td><td><span class="rpill">â˜… 5.0 Â· 217</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+18582782800">858-278-2800</a><br><a href="https://sandiegoprobatelaw.com" target="_blank">sandiegoprobatelaw.com</a><br><span class="predicted">info@sandiegoprobatelaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Lawyer In Blue Jeans Group" data-email="frontdesk@lawyerinbluejeans.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‰ 3</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:85%"></div></div><span class="score-val">85</span></div></td><td><div class="firm-row"><span class="firm-name">Lawyer In Blue Jeans Group</span></div><div class="firm-addr">ğŸ“ 3990 Old Town Ave A-102, San Diego, CA 92110</div></td><td><span class="rpill">â˜… 4.6 Â· 53</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">senior</span></div></td><td><div class="contact"><a href="tel:+16196832545">619-683-2545</a><br><a href="https://www.lawyerinbluejeans.com" target="_blank">lawyerinbluejeans.com</a><br><a href="mailto:frontdesk@lawyerinbluejeans.com">frontdesk@lawyerinbluejeans.com</a></div></td></tr>
          <tr data-firm="Jenkins & Jenkins, Estate Planning" data-email="support@jjlawca.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">4</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:80%"></div></div><span class="score-val">80</span></div></td><td><div class="firm-row"><span class="firm-name">Jenkins &amp; Jenkins, Estate Planning</span></div><div class="firm-addr">ğŸ“ 9619 Chesapeake Dr #200, San Diego, CA 92123</div></td><td><span class="rpill">â˜… 5.0 Â· 160</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+18587662170">858-766-2170</a><br><a href="https://www.jjlawca.com" target="_blank">jjlawca.com</a><br><a href="mailto:support@jjlawca.com">support@jjlawca.com</a></div></td></tr>
          <tr data-firm="San Diego Legacy Law, PC" data-email="info@sdlegacylaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">5</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:80%"></div></div><span class="score-val">80</span></div></td><td><div class="firm-row"><span class="firm-name">San Diego Legacy Law, PC</span></div><div class="firm-addr">ğŸ“ 3517 Camino del Rio S #406, San Diego, CA 92108</div></td><td><span class="rpill">â˜… 4.9 Â· 52</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+16195503080">619-550-3080</a><br><a href="https://www.sdlegacylaw.com" target="_blank">sdlegacylaw.com</a><br><span class="predicted">info@sdlegacylaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Lancier Legal, PC" data-email="info@lancierlegal.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">6</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Lancier Legal, PC</span></div><div class="firm-addr">ğŸ“ 501 W Broadway Ste 1620, San Diego, CA 92101</div></td><td><span class="rpill">â˜… 5.0 Â· 63</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+16193335344">619-333-5344</a><br><a href="https://estateplanningattorneyca.com" target="_blank">estateplanningattorneyca.com</a><br><a href="mailto:info@lancierlegal.com">info@lancierlegal.com</a></div></td></tr>
          <tr data-firm="Shaw Legal Office, APC" data-email="info@shawlegaloffice.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">7</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Shaw Legal Office, APC</span></div><div class="firm-addr">ğŸ“ San Diego, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 145</span></td><td><div class="kws">â€”</div></td><td><div class="contact"><a href="tel:+16194311080">619-431-1080</a><br><a href="https://www.shawlegaloffice.com" target="_blank">shawlegaloffice.com</a><br><span class="predicted">info@shawlegaloffice.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Mellman & Mellman, LLP" data-email="info@mellmanlaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">8</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Mellman &amp; Mellman, LLP</span></div><div class="firm-addr">ğŸ“ San Diego, CA</div></td><td><span class="rpill">â˜… 4.9 Â· 210</span></td><td><div class="kws">â€”</div></td><td><div class="contact"><a href="tel:+16193040606">619-304-0606</a><br><span class="predicted">info@mellmanlaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Mark Ignacio Law, APC" data-email="info@ignaciolaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">9</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:65%"></div></div><span class="score-val">65</span></div></td><td><div class="firm-row"><span class="firm-name">Mark Ignacio Law, APC</span></div><div class="firm-addr">ğŸ“ San Diego, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 175</span></td><td><div class="kws">â€”</div></td><td><div class="contact"><a href="tel:+16198104647">619-810-4647</a><br><a href="https://www.ignaciolaw.com" target="_blank">ignaciolaw.com</a><br><span class="predicted">info@ignaciolaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Brierton, Jones & Jones, LLP" data-email="info@brierton.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">10</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:65%"></div></div><span class="score-val">65</span></div></td><td><div class="firm-row"><span class="firm-name">Brierton, Jones &amp; Jones, LLP</span></div><div class="firm-addr">ğŸ“ San Diego, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 20</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+16196967066">619-696-7066</a><br><span class="predicted">info@brierton.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- SD Elder Law -->
    <div class="panel" id="sd-panel-elder">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">20</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">80</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">4 ğŸ†•</div><div class="stat-lbl">New vs Estate List</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'sd-panel-elder')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="sd" data-type="elder">
          <tr data-firm="Lancier Legal, PC" data-email="info@lancierlegal.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:80%"></div></div><span class="score-val">80</span></div></td><td><div class="firm-row"><span class="firm-name">Lancier Legal, PC</span></div><div class="firm-addr">ğŸ“ 501 W Broadway #2700, San Diego, CA 92101</div></td><td><span class="rpill">â˜… 5.0 Â· 63</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+16193335344">619-333-5344</a><br><a href="mailto:info@lancierlegal.com">info@lancierlegal.com</a></div></td></tr>
          <tr data-firm="Bryant Dieringer & Wilson" data-email="info@bdwlaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥ˆ 2</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:80%"></div></div><span class="score-val">80</span></div></td><td><div class="firm-row"><span class="firm-name">Bryant Dieringer &amp; Wilson <span class="new-tag">NEW</span></span></div><div class="firm-addr">ğŸ“ 402 W Broadway #2700, San Diego, CA 92101</div></td><td><span class="rpill">â˜… 4.6 Â· 13</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">senior</span></div></td><td><div class="contact"><a href="tel:+16196932700">619-693-2700</a><br><a href="https://www.californiaelderabuselawyer.com" target="_blank">californiaelderabuselawyer.com</a><br><span class="predicted">info@bdwlaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="San Diego Elder Law Center" data-email="info@sandiegoelderlaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‰ 3</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:75%"></div></div><span class="score-val">75</span></div></td><td><div class="firm-row"><span class="firm-name">San Diego Elder Law Center <span class="new-tag">NEW</span></span></div><div class="firm-addr">ğŸ“ 7880 Golfcrest Dr, San Diego, CA 92119</div></td><td><span class="rpill">â˜… 4.7 Â· 42</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+16192354357">619-235-4357</a><br><a href="https://www.sandiegoelderlaw.com" target="_blank">sandiegoelderlaw.com</a><br><a href="mailto:info@sandiegoelderlaw.com">info@sandiegoelderlaw.com</a></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- SD Fiduciaries -->
    <div class="panel" id="sd-panel-fiduciary">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">20</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">70</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">191</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'sd-panel-fiduciary')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="sd" data-type="fiduciary">
          <tr data-firm="Finest City Fiduciary" data-email="Dion@FinestCityFiduciary.com" data-contact="Dion"><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Finest City Fiduciary</span></div><div class="firm-addr">ğŸ“ 3245 University Ave, San Diego, CA 92104</div></td><td><span class="rpill">â˜… 4.7 Â· 12</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">trust</span><span class="kw">fiduciary</span></div></td><td><div class="contact"><a href="tel:+16195017902">619-501-7902</a><br><a href="https://finestcityfiduciary.com" target="_blank">finestcityfiduciary.com</a><br><a href="mailto:Dion@FinestCityFiduciary.com">Dion@FinestCityFiduciary.com</a></div></td></tr>
          <tr data-firm="Platt Wealth Management" data-email="info@plattwm.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥ˆ 2</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Platt Wealth Management</span></div><div class="firm-addr">ğŸ“ San Diego, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 22</span></td><td><div class="kws"><span class="kw">estate</span><span class="kw">trust</span><span class="kw">fiduciary</span></div></td><td><div class="contact"><a href="tel:+16192559550">619-255-9550</a><br><a href="https://plattwm.com" target="_blank">plattwm.com</a><br><span class="predicted">info@plattwm.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- SD Assisted Living -->
    <div class="panel" id="sd-panel-assisted">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">20</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">75</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">4.9â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">118</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'sd-panel-assisted')"></th><th>#</th><th>Score</th><th>Facility + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="sd" data-type="assisted">
          <tr data-firm="Wesley Palms Retirement Community" data-email="info@wesleypalms.org" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:75%"></div></div><span class="score-val">75</span></div></td><td><div class="firm-row"><span class="firm-name">Wesley Palms Retirement Community</span></div><div class="firm-addr">ğŸ“ 2404 Loring St, San Diego, CA 92109</div></td><td><span class="rpill">â˜… 4.7 Â· 118</span></td><td><div class="kws"><span class="kw">senior</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+18583586054">858-358-6054</a><br><a href="https://frontporch.net/community/wesley-palms" target="_blank">wesleypalms.org</a><br><span class="predicted">info@wesleypalms.org âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Merrill Gardens at Bankers Hill" data-email="sandiego@merrillgardens.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥ˆ 2</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:70%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Merrill Gardens at Bankers Hill</span></div><div class="firm-addr">ğŸ“ 2567 Second Ave, San Diego, CA 92103</div></td><td><span class="rpill">â˜… 4.7 Â· 41</span></td><td><div class="kws"><span class="kw">senior</span><span class="kw">downsizing</span></div></td><td><div class="contact"><a href="tel:+16194711839">619-471-1839</a><br><a href="https://www.merrillgardens.com" target="_blank">merrillgardens.com</a><br><span class="predicted">sandiego@merrillgardens.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- SD Queue Panel -->
    <div class="panel" id="sd-panel-queue">
      <div class="queue-stats">
        <div class="queue-stat"><span class="queue-stat-num overdue" id="queueOverdue">0</span><span class="queue-stat-label">ğŸ”¥ Overdue</span></div>
        <div class="queue-stat"><span class="queue-stat-num new" id="queueNew">0</span><span class="queue-stat-label">âš¡ New</span></div>
        <div class="queue-stat"><span class="queue-stat-num recent" id="queueRecent">0</span><span class="queue-stat-label">ğŸ• Recent</span></div>
      </div>
      <div style="padding:12px 18px;border-bottom:1px solid var(--line)">
        <button class="btn-email" onclick="openQueueEmailModal()">ğŸ“§ Send to Selected (Overdue/New)</button>
      </div>
      <table class="queue-table">
        <thead><tr><th class="priority-col">Priority</th><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="status-col">Status</th><th class="last-touch-col">Last Touch</th><th class="action-col">Next Action</th></tr></thead>
        <tbody id="queueTableBody">
        </tbody>
      </table>
    </div>

    <!-- SD Archive Panel -->
    <div class="panel" id="sd-panel-archive">
      <div class="archive-stats">
        <div class="archive-stat"><span class="archive-stat-num partners" id="archivePartners">0</span><span class="archive-stat-label">ğŸŸ¢ Partners</span></div>
        <div class="archive-stat"><span class="archive-stat-num passes" id="archivePasses">0</span><span class="archive-stat-label">âš« Passed</span></div>
      </div>
      <div class="archive-section">
        <div class="archive-header partners">ğŸŸ¢ Partner Firms</div>
        <table class="archive-table">
          <thead><tr><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="notes-col">Notes</th><th class="action-col">Action</th></tr></thead>
          <tbody id="archivePartnersBody">
          </tbody>
        </table>
      </div>
      <div class="archive-section">
        <div class="archive-header passes">âš« Passed Firms</div>
        <table class="archive-table">
          <thead><tr><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="notes-col">Reason / Notes</th><th class="action-col">Action</th></tr></thead>
          <tbody id="archivePassesBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Orange County View -->
  <div class="city-view" id="city-oc">
    <div class="tabs">
      <button class="tab active" onclick="showTab('oc','estate',this)">âš–ï¸ Estate Attorneys</button>
      <button class="tab" onclick="showTab('oc','elder',this)">ğŸ‘´ Elder Law</button>
      <button class="tab" onclick="showTab('oc','fiduciary',this)">ğŸ¦ Fiduciaries</button>
      <button class="tab" onclick="showTab('oc','assisted',this)">ğŸ  Assisted Living</button>
      <button class="tab" onclick="showTab('oc','queue',this)">ğŸ“‹ Queue</button>
      <button class="tab" onclick="showTab('oc','archive',this)">ğŸ—‚ Archive</button>
    </div>

    <!-- OC Estate Attorneys -->
    <div class="panel active" id="oc-panel-estate">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">10</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">75</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">296</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'oc-panel-estate')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="oc" data-type="estate">
          <tr data-firm="Snyder Law, PC" data-email="info@snyderlaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:100%"></div></div><span class="score-val">75</span></div></td><td><div class="firm-row"><span class="firm-name">Snyder Law, PC</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 131</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">senior</span></div></td><td><div class="contact"><a href="tel:+19493333701">949-333-3701</a><br><a href="https://snyderlaw.com" target="_blank">snyderlaw.com</a><br><span class="predicted">info@snyderlaw.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Mortensen & Reinheimer, PC" data-email="info@oc-probate.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥ˆ 2</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:93%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Mortensen &amp; Reinheimer, PC</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 4.9 Â· 88</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+17143846053">714-384-6053</a><br><a href="https://oc-probate.com" target="_blank">oc-probate.com</a><br><span class="predicted">info@oc-probate.com âœ¦ predicted</span></div></td></tr>
          <tr data-firm="Patrick D'Arcy Law Offices" data-email="info@oc-attorneys.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‰ 3</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:93%"></div></div><span class="score-val">70</span></div></td><td><div class="firm-row"><span class="firm-name">Patrick D'Arcy Law Offices</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 58</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">trust</span></div></td><td><div class="contact"><a href="tel:+19499887647">949-988-7647</a><br><a href="https://oc-attorneys.com" target="_blank">oc-attorneys.com</a><br><span class="predicted">info@oc-attorneys.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- OC Elder Law -->
    <div class="panel" id="oc-panel-elder">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">10</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">75</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">296</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'oc-panel-elder')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="oc" data-type="elder">
          <tr data-firm="Snyder Law, PC" data-email="info@snyderlaw.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-high" style="width:100%"></div></div><span class="score-val">75</span></div></td><td><div class="firm-row"><span class="firm-name">Snyder Law, PC</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 131</span></td><td><div class="kws"><span class="kw">probate</span><span class="kw">estate</span><span class="kw">senior</span></div></td><td><div class="contact"><a href="tel:+19493333701">949-333-3701</a><br><a href="https://snyderlaw.com" target="_blank">snyderlaw.com</a><br><span class="predicted">info@snyderlaw.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- OC Fiduciaries -->
    <div class="panel" id="oc-panel-fiduciary">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">10</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">60</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">95</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'oc-panel-fiduciary')"></th><th>#</th><th>Score</th><th>Firm + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="oc" data-type="fiduciary">
          <tr data-firm="Falcon Wealth Planning" data-email="info@falconwealthplanning.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:100%"></div></div><span class="score-val">60</span></div></td><td><div class="firm-row"><span class="firm-name">Falcon Wealth Planning</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 5.0 Â· 76</span></td><td><div class="kws"><span class="kw">estate</span><span class="kw">trust</span><span class="kw">fiduciary</span></div></td><td><div class="contact"><a href="tel:+18559632523">855-963-2523</a><br><a href="https://falconwealthplanning.com" target="_blank">falconwealthplanning.com</a><br><span class="predicted">info@falconwealthplanning.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- OC Assisted Living -->
    <div class="panel" id="oc-panel-assisted">
      <div class="stats-bar">
        <div class="stat"><div class="stat-num">10</div><div class="stat-lbl">Ranked</div></div>
        <div class="stat"><div class="stat-num">50</div><div class="stat-lbl">Top Score</div></div>
        <div class="stat"><div class="stat-num" style="color:var(--teal)">5.0â˜…</div><div class="stat-lbl">Best Rating</div></div>
        <div class="stat"><div class="stat-num">87</div><div class="stat-lbl">Most Reviews</div></div>
      </div>
      <table>
        <thead><tr><th style="width:40px"><input type="checkbox" onchange="toggleAllInPanel(this,'oc-panel-assisted')"></th><th>#</th><th>Score</th><th>Facility + Address</th><th>Rating</th><th>Keywords</th><th>Contact</th></tr></thead>
        <tbody data-city="oc" data-type="assisted">
          <tr data-firm="Meridian at Laguna Hills" data-email="info@meridianseniorliving.com" data-contact=""><td class="rank-num"><input type="checkbox" class="row-checkbox" onchange="updateSelection()"></td><td class="rank-num">ğŸ¥‡ 1</td><td><div class="score-cell"><div class="score-bg"><div class="score-fill s-mid" style="width:100%"></div></div><span class="score-val">50</span></div></td><td><div class="firm-row"><span class="firm-name">Meridian at Laguna Hills</span></div><div class="firm-addr">ğŸ“ Orange County, CA</div></td><td><span class="rpill">â˜… 4.6 Â· 79</span></td><td><div class="kws"><span class="kw">estate</span></div></td><td><div class="contact"><a href="tel:+19499986290">949-998-6290</a><br><a href="https://meridianseniorliving.com" target="_blank">meridianseniorliving.com</a><br><span class="predicted">info@meridianseniorliving.com âœ¦ predicted</span></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- OC Queue Panel -->
    <div class="panel" id="oc-panel-queue">
      <div class="queue-stats">
        <div class="queue-stat"><span class="queue-stat-num overdue" id="ocQueueOverdue">0</span><span class="queue-stat-label">ğŸ”¥ Overdue</span></div>
        <div class="queue-stat"><span class="queue-stat-num new" id="ocQueueNew">0</span><span class="queue-stat-label">âš¡ New</span></div>
        <div class="queue-stat"><span class="queue-stat-num recent" id="ocQueueRecent">0</span><span class="queue-stat-label">ğŸ• Recent</span></div>
      </div>
      <div style="padding:12px 18px;border-bottom:1px solid var(--line)">
        <button class="btn-email" onclick="openQueueEmailModal()">ğŸ“§ Send to Selected (Overdue/New)</button>
      </div>
      <table class="queue-table">
        <thead><tr><th class="priority-col">Priority</th><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="status-col">Status</th><th class="last-touch-col">Last Touch</th><th class="action-col">Next Action</th></tr></thead>
        <tbody id="ocQueueTableBody">
        </tbody>
      </table>
    </div>

    <!-- OC Archive Panel -->
    <div class="panel" id="oc-panel-archive">
      <div class="archive-stats">
        <div class="archive-stat"><span class="archive-stat-num partners" id="ocArchivePartners">0</span><span class="archive-stat-label">ğŸŸ¢ Partners</span></div>
        <div class="archive-stat"><span class="archive-stat-num passes" id="ocArchivePasses">0</span><span class="archive-stat-label">âš« Passed</span></div>
      </div>
      <div class="archive-section">
        <div class="archive-header partners">ğŸŸ¢ Partner Firms</div>
        <table class="archive-table">
          <thead><tr><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="notes-col">Notes</th><th class="action-col">Action</th></tr></thead>
          <tbody id="ocArchivePartnersBody">
          </tbody>
        </table>
      </div>
      <div class="archive-section">
        <div class="archive-header passes">âš« Passed Firms</div>
        <table class="archive-table">
          <thead><tr><th class="firm-col">Firm</th><th class="city-col">City</th><th class="type-col">Type</th><th class="score-col">Score</th><th class="notes-col">Reason / Notes</th><th class="action-col">Action</th></tr></thead>
          <tbody id="ocArchivePassesBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div style="text-align:center;margin-top:20px;color:var(--muted);font-size:.72rem;padding-bottom:20px">
    TLH Scout Â· San Diego + Orange County Partner Search Â· Feb 20, 2026 Â· Powered by Google Places API Â· <em>âœ¦ = email predicted from domain pattern</em>
  </div>
</div>

<!-- Status Dropdown (single instance, repositioned) -->
<div class="status-dropdown" id="statusDropdown">
  <div class="status-option" data-status="new"><span class="status-dot sd-new"></span> ğŸ”µ New</div>
  <div class="status-option" data-status="touch1"><span class="status-dot sd-t1"></span> ğŸŸ¡ Touch 1</div>
  <div class="status-option" data-status="touch2"><span class="status-dot sd-t2"></span> ğŸŸ  Touch 2</div>
  <div class="status-option" data-status="touch3"><span class="status-dot sd-t3"></span> ğŸŸ£ Touch 3</div>
  <div class="status-option" data-status="partner"><span class="status-dot sd-partner"></span> ğŸŸ¢ Partner</div>
  <div class="status-option" data-status="pass"><span class="status-dot sd-pass"></span> âš« Pass</div>
</div>

<!-- Email Modal -->
<div class="modal-overlay" id="emailModal">
  <div class="modal">
    <div class="modal-header">
      <h2>ğŸ“§ Send Email Campaign</h2>
      <button class="modal-close" onclick="closeEmailModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-template">
        <div class="modal-template-label">Selected Template</div>
        <div class="modal-template-name" id="modalTemplateName">Intro Letter â€” Touch 1</div>
      </div>
      <div class="modal-firms" id="modalFirms">
      </div>
      <div class="form-group">
        <label class="form-label">Subject Line</label>
        <input type="text" class="form-input" id="emailSubject" value="Partnership Opportunity â€” True Legacy Homes">
      </div>
      <div class="form-group">
        <label class="form-label">Message Preview</label>
        <textarea class="form-textarea" id="emailBody">Hi {{contact_name}},

My name is Justin Hart, and I'm the marketing director for True Legacy Homes â€” San Diego's leading estate sale and senior transition company.

We work with families navigating estate settlements, downsizing, and senior transitions every day. Many of our clients are also in need of [estate attorney / fiduciary / elder law / assisted living] services, and we'd love to explore a referral relationship.

Could we schedule a 15-minute call to explore how we might send business each other's way?

Best,
Justin Hart
True Legacy Homes
tlhmarketing619@gmail.com
(619) 937-3816
truelegacyhomes.com</textarea>
      </div>
      <div class="modal-actions">
        <button class="btn-primary" onclick="sendViaGmail()">ğŸ“¨ Send via Gmail</button>
        <button class="btn-secondary" onclick="exportCSV()">ğŸ“¥ Export as CSV</button>
        <button class="btn-log" onclick="logSends()">ğŸ“Š Log These Sends</button>
        <button class="btn-cancel" onclick="closeEmailModal()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
// ===== LOCALSTORAGE KEYS =====
const STATUS_KEY = 'tlh_scout_status';
const TOUCHES_KEY = 'tlh_scout_touches';
const NOTES_KEY = 'tlh_scout_notes';
const REASONS_KEY = 'tlh_scout_reasons';
const SHEET_URL_KEY = 'tlh_scout_sheet_url';

// ===== STATUS CONFIG =====
const STATUS_CONFIG = {
  new: { label: 'New', class: 's-new', color: '#3b82f6' },
  touch1: { label: 'Touch 1', class: 's-touch1', color: '#f59e0b' },
  touch2: { label: 'Touch 2', class: 's-touch2', color: '#f97316' },
  touch3: { label: 'Touch 3', class: 's-touch3', color: '#8b5cf6' },
  partner: { label: 'Partner', class: 's-partner', color: '#16a34a' },
  pass: { label: 'Pass', class: 's-pass', color: '#6b7280' }
};

const STATUS_LABELS = {
  new: 'ğŸ”µ New',
  touch1: 'ğŸŸ¡ Touch 1',
  touch2: 'ğŸŸ  Touch 2',
  touch3: 'ğŸŸ£ Touch 3',
  partner: 'ğŸŸ¢ Partner',
  pass: 'âš« Pass'
};

const TYPE_ICONS = {
  estate: 'âš–ï¸ Estate',
  elder: 'ğŸ‘´ Elder Law',
  fiduciary: 'ğŸ¦ Fiduciary',
  assisted: 'ğŸ  Assisted'
};

const CITY_NAMES = {
  sd: 'San Diego',
  oc: 'Orange County'
};

// ===== EMAIL TEMPLATES =====
const emailTemplates = {
  touch1: {
    name: "Intro Letter â€” Touch 1",
    subject: "Partnership Opportunity â€” True Legacy Homes",
    body: `Hi {{contact_name}},

My name is Justin Hart, and I'm the marketing director for True Legacy Homes â€” San Diego's leading estate sale and senior transition company.

We work with families navigating estate settlements, downsizing, and senior transitions every day. Many of our clients are also in need of [estate attorney / fiduciary / elder law / assisted living] services, and we'd love to explore a referral relationship.

Could we schedule a 15-minute call to explore how we might send business each other's way?

Best,
Justin Hart
True Legacy Homes
tlhmarketing619@gmail.com
(619) 937-3816
truelegacyhomes.com`
  },
  touch2: {
    name: "Follow-up Postcard â€” Touch 2",
    subject: "Following up â€” TLH Partner Program",
    body: `Hi {{contact_name}},

I reached out a couple weeks ago about a referral partnership with True Legacy Homes. We're the team behind many of San Diego's estate sales â€” and we're actively looking for trusted [estate attorney / elder law / fiduciary / assisted living] partners to refer our families to.

Would love to connect. Reply here or call (619) 937-3816.

Justin Hart | True Legacy Homes`
  },
  touch3: {
    name: "Partner Invite â€” Touch 3",
    subject: "One last note â€” TLH Partner Referral Program",
    body: `Hi {{contact_name}},

Third and final note â€” we'd genuinely love to have {{firm_name}} in our partner network. Our clients regularly need your services, and we think there's a real mutual win here.

If now isn't the right time, no worries. But if you're open to a quick conversation, I'm easy to reach.

Justin Hart | True Legacy Homes | (619) 937-3816`
  }
};

// ===== TRACKING STATE =====
let selectedFirms = [];
let queueSelectedFirms = [];
let currentDropdownFirm = null;

// ===== INITIALIZE =====
document.addEventListener('DOMContentLoaded', function() {
  renderAllStatusPills();
  renderQueue();
  renderArchive();
  setupStatusDropdown();
});

// ===== LOCALSTORAGE HELPERS =====
function getStatuses() {
  try {
    return JSON.parse(localStorage.getItem(STATUS_KEY)) || {};
  } catch { return {}; }
}

function saveStatuses(statuses) {
  localStorage.setItem(STATUS_KEY, JSON.stringify(statuses));
}

function getTouches() {
  try {
    return JSON.parse(localStorage.getItem(TOUCHES_KEY)) || {};
  } catch { return {}; }
}

function saveTouches(touches) {
  localStorage.setItem(TOUCHES_KEY, JSON.stringify(touches));
}

function getNotes() {
  try {
    return JSON.parse(localStorage.getItem(NOTES_KEY)) || {};
  } catch { return {}; }
}

function saveNotes(notes) {
  localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
}

function getReasons() {
  try {
    return JSON.parse(localStorage.getItem(REASONS_KEY)) || {};
  } catch { return {}; }
}

function saveReasons(reasons) {
  localStorage.setItem(REASONS_KEY, JSON.stringify(reasons));
}

// ===== STATUS PILL RENDERING =====
function renderAllStatusPills() {
  const statuses = getStatuses();
  document.querySelectorAll('tbody tr[data-firm]').forEach(row => {
    const firmName = row.dataset.firm;
    const status = statuses[firmName] || 'new';
    addStatusPillToRow(row, firmName, status);
  });
}

function addStatusPillToRow(row, firmName, status) {
  const firmRow = row.querySelector('.firm-row');
  if (!firmRow) return;
  
  // Remove existing pill if any
  const existingPill = firmRow.querySelector('.status-pill');
  if (existingPill) existingPill.remove();
  
  const config = STATUS_CONFIG[status] || STATUS_CONFIG.new;
  const pill = document.createElement('span');
  pill.className = `status-pill ${config.class}`;
  pill.dataset.firm = firmName;
  pill.dataset.status = status;
  pill.innerHTML = `<span class="status-dot"></span>${config.label}`;
  pill.onclick = (e) => showStatusDropdown(e, firmName);
  
  firmRow.appendChild(pill);
}

// ===== STATUS DROPDOWN =====
function setupStatusDropdown() {
  const dropdown = document.getElementById('statusDropdown');
  
  document.querySelectorAll('.status-option').forEach(opt => {
    opt.onclick = () => {
      if (currentDropdownFirm) {
        changeStatus(currentDropdownFirm, opt.dataset.status);
        hideStatusDropdown();
      }
    };
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.status-pill') && !e.target.closest('.status-dropdown')) {
      hideStatusDropdown();
    }
  });
}

function showStatusDropdown(e, firmName) {
  e.stopPropagation();
  currentDropdownFirm = firmName;
  
  const dropdown = document.getElementById('statusDropdown');
  const pill = e.target.closest('.status-pill');
  
  // Position dropdown near the pill
  const rect = pill.getBoundingClientRect();
  dropdown.style.top = (rect.bottom + window.scrollY + 4) + 'px';
  dropdown.style.left = rect.left + 'px';
  
  dropdown.classList.add('show');
}

function hideStatusDropdown() {
  document.getElementById('statusDropdown').classList.remove('show');
  currentDropdownFirm = null;
}

function changeStatus(firmName, newStatus) {
  const statuses = getStatuses();
  const oldStatus = statuses[firmName] || 'new';
  statuses[firmName] = newStatus;
  saveStatuses(statuses);
  
  // Update pill in all rows with this firm
  document.querySelectorAll(`.status-pill[data-firm="${firmName}"]`).forEach(pill => {
    const config = STATUS_CONFIG[newStatus];
    pill.className = `status-pill ${config.class}`;
    pill.dataset.status = newStatus;
    pill.innerHTML = `<span class="status-dot"></span>${config.label}`;
  });
  
  // Refresh queue and archive
  renderQueue();
  renderArchive();
  
  // Sync to Google Sheet if URL exists
  syncToSheet(firmName, newStatus);
}

function syncToSheet(firmName, status) {
  const sheetUrl = localStorage.getItem(SHEET_URL_KEY);
  if (!sheetUrl) return;
  
  fetch(sheetUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ firm: firmName, status: status })
  }).catch(() => {}); // Fail silently
}

// ===== QUEUE RENDERING =====
function getAllFirms() {
  const firms = [];
  document.querySelectorAll('tbody tr[data-firm]').forEach(row => {
    const tbody = row.closest('tbody');
    firms.push({
      name: row.dataset.firm,
      email: row.dataset.email,
      contact: row.dataset.contact || row.dataset.firm.split(' ')[0],
      city: tbody.dataset.city,
      type: tbody.dataset.type,
      score: parseInt(row.querySelector('.score-val')?.textContent || '0')
    });
  });
  return firms;
}

function getLastTouchDate(firmName) {
  const touches = getTouches();
  const firmTouches = touches[firmName] || [];
  if (firmTouches.length === 0) return null;
  
  const dates = firmTouches.map(t => new Date(t.date));
  return new Date(Math.max.apply(null, dates));
}

function isOverdue(firmName) {
  const lastTouch = getLastTouchDate(firmName);
  if (!lastTouch) return false;
  
  const daysSince = (new Date() - lastTouch) / (1000 * 60 * 60 * 24);
  return daysSince >= 14;
}

function getDaysSinceTouch(firmName) {
  const lastTouch = getLastTouchDate(firmName);
  if (!lastTouch) return null;
  return Math.floor((new Date() - lastTouch) / (1000 * 60 * 60 * 24));
}

function getStatus(firmName) {
  const statuses = getStatuses();
  return statuses[firmName] || 'new';
}

function getNextAction(firmName) {
  const status = getStatus(firmName);
  const daysSince = getDaysSinceTouch(firmName);
  
  if (status === 'new') return { text: 'Send Touch 1', urgent: true };
  if (status === 'touch1') {
    if (isOverdue(firmName)) return { text: 'Send Touch 2', urgent: true };
    return { text: `Wait ${14 - daysSince} more days`, urgent: false };
  }
  if (status === 'touch2') {
    if (isOverdue(firmName)) return { text: 'Send Touch 3', urgent: true };
    return { text: `Wait ${14 - daysSince} more days`, urgent: false };
  }
  if (status === 'touch3') {
    if (isOverdue(firmName)) return { text: 'Follow up personally', urgent: true };
    return { text: `Wait ${14 - daysSince} more days`, urgent: false };
  }
  return { text: 'â€”', urgent: false };
}

function getQueuePriority(firmName) {
  const status = getStatus(firmName);
  const overdue = isOverdue(firmName);
  
  if (overdue && ['touch1', 'touch2', 'touch3'].includes(status)) return 1; // Overdue
  if (status === 'new') return 2; // New
  if (getLastTouchDate(firmName)) return 3; // Recently touched
  return 4;
}

function renderQueue() {
  const statuses = getStatuses();
  const firms = getAllFirms();
  
  // Filter to active firms only (not partner/pass)
  const activeFirms = firms.filter(f => {
    const status = getStatus(f.name);
    return status !== 'partner' && status !== 'pass';
  });
  
  // Sort by priority
  activeFirms.sort((a, b) => getQueuePriority(a.name) - getQueuePriority(b.name));
  
  // Count stats
  let overdue = 0, isNew = 0, recent = 0;
  activeFirms.forEach(f => {
    const priority = getQueuePriority(f.name);
    if (priority === 1) overdue++;
    else if (priority === 2) isNew++;
    else if (priority === 3) recent++;
  });
  
  // Update stats
  document.getElementById('queueOverdue').textContent = overdue;
  document.getElementById('queueNew').textContent = isNew;
  document.getElementById('queueRecent').textContent = recent;
  document.getElementById('ocQueueOverdue').textContent = overdue;
  document.getElementById('ocQueueNew').textContent = isNew;
  document.getElementById('ocQueueRecent').textContent = recent;
  
  // Render SD and OC queue tables
  renderQueueTable('queueTableBody', activeFirms.filter(f => f.city === 'sd'));
  renderQueueTable('ocQueueTableBody', activeFirms.filter(f => f.city === 'oc'));
}

function renderQueueTable(tbodyId, firms) {
  const tbody = document.getElementById(tbodyId);
  tbody.innerHTML = '';
  
  firms.forEach(f => {
    const status = getStatus(f.name);
    const priority = getQueuePriority(f.name);
    const lastTouch = getLastTouchDate(f.name);
    const daysSince = getDaysSinceTouch(f.name);
    const nextAction = getNextAction(f.name);
    
    let priorityBadge, priorityLabel;
    if (priority === 1) {
      priorityBadge = 'overdue';
      priorityLabel = 'ğŸ”¥ Overdue';
    } else if (priority === 2) {
      priorityBadge = 'is-new';
      priorityLabel = 'âš¡ New';
    } else {
      priorityBadge = 'recent';
      priorityLabel = 'ğŸ• Recent';
    }
    
    const row = document.createElement('tr');
    row.dataset.firm = f.name;
    row.innerHTML = `
      <td><span class="priority-badge ${priorityBadge}">${priorityLabel}</span></td>
      <td><div class="firm-row"><span class="firm-name">${f.name}</span></div></td>
      <td>${CITY_NAMES[f.city]}</td>
      <td>${TYPE_ICONS[f.type]}</td>
      <td>${f.score}</td>
      <td><span class="status-pill s-${status}" style="cursor:default">${STATUS_LABELS[status]}</span></td>
      <td>${lastTouch ? (daysSince === 0 ? 'Today' : `${daysSince}d ago`) : 'â€”'}</td>
      <td><span class="action-text ${nextAction.urgent ? 'urgent' : ''}">${nextAction.text}</span></td>
    `;
    tbody.appendChild(row);
  });
}

// ===== ARCHIVE RENDERING =====
function renderArchive() {
  const firms = getAllFirms();
  const partners = firms.filter(f => getStatus(f.name) === 'partner');
  const passes = firms.filter(f => getStatus(f.name) === 'pass');
  
  // Update stats
  document.getElementById('archivePartners').textContent = partners.length;
  document.getElementById('archivePasses').textContent = passes.length;
  document.getElementById('ocArchivePartners').textContent = partners.filter(f => f.city === 'oc').length;
  document.getElementById('ocArchivePasses').textContent = passes.filter(f => f.city === 'oc').length;
  
  // Render tables
  renderArchiveTable('archivePartnersBody', partners.filter(f => f.city === 'sd'), 'partner');
  renderArchiveTable('ocArchivePartnersBody', partners.filter(f => f.city === 'oc'), 'partner');
  renderArchiveTable('archivePassesBody', passes.filter(f => f.city === 'sd'), 'pass');
  renderArchiveTable('ocArchivePassesBody', passes.filter(f => f.city === 'oc'), 'pass');
}

function renderArchiveTable(tbodyId, firms, type) {
  const tbody = document.getElementById(tbodyId);
  tbody.innerHTML = '';
  
  const notes = getNotes();
  const reasons = getReasons();
  
  firms.forEach(f => {
    const note = notes[f.name] || '';
    const reason = reasons[f.name] || '';
    
    const row = document.createElement('tr');
    row.dataset.firm = f.name;
    
    if (type === 'partner') {
      row.innerHTML = `
        <td><span class="firm-name">${f.name}</span></td>
        <td>${CITY_NAMES[f.city]}</td>
        <td>${TYPE_ICONS[f.type]}</td>
        <td>${f.score}</td>
        <td><input type="text" class="inline-notes" value="${note}" placeholder="Add notes..." onchange="saveNote('${f.name}', this.value)"></td>
        <td class="action-col"><button class="btn-restore" onclick="restoreFirm('${f.name}')">â†©ï¸ Restore</button></td>
      `;
    } else {
      row.innerHTML = `
        <td><span class="firm-name">${f.name}</span></td>
        <td>${CITY_NAMES[f.city]}</td>
        <td>${TYPE_ICONS[f.type]}</td>
        <td>${f.score}</td>
        <td><input type="text" class="inline-reason" value="${reason}" placeholder="Reason for passing..." onchange="saveReason('${f.name}', this.value)"></td>
        <td class="action-col"><button class="btn-restore" onclick="restoreFirm('${f.name}')">â†©ï¸ Restore</button></td>
      `;
    }
    
    tbody.appendChild(row);
  });
}

function saveNote(firmName, value) {
  const notes = getNotes();
  notes[firmName] = value;
  saveNotes(notes);
}

function saveReason(firmName, value) {
  const reasons = getReasons();
  reasons[firmName] = value;
  saveReasons(reasons);
}

function restoreFirm(firmName) {
  changeStatus(firmName, 'new');
}

// ===== CITY/TAB SWITCHING =====
function showCity(cityId, btn) {
  document.querySelectorAll('.city-view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.city-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('city-' + cityId).classList.add('active');
  btn.classList.add('active');
}

function showTab(cityId, name, el) {
  document.querySelectorAll('#city-' + cityId + ' .tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('#city-' + cityId + ' .panel').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(cityId + '-panel-' + name).classList.add('active');
}

// ===== SELECTION =====
function updateSelection() {
  const checkboxes = document.querySelectorAll('.row-checkbox:checked');
  selectedFirms = [];
  checkboxes.forEach(cb => {
    const row = cb.closest('tr');
    selectedFirms.push({
      name: row.dataset.firm,
      email: row.dataset.email,
      contact: row.dataset.contact || row.dataset.firm.split(' ')[0]
    });
    row.classList.add('selected');
  });
  
  document.querySelectorAll('.row-checkbox:not(:checked)').forEach(cb => {
    cb.closest('tr').classList.remove('selected');
  });
  
  document.getElementById('selectedCount').textContent = selectedFirms.length + ' firms selected';
}

function toggleAllInPanel(checkbox, panelId) {
  const panel = document.getElementById(panelId);
  const checkboxes = panel.querySelectorAll('.row-checkbox');
  checkboxes.forEach(cb => {
    cb.checked = checkbox.checked;
  });
  updateSelection();
}

function toggleSelectAll() {
  const selectAll = document.getElementById('selectAll').checked;
  const cityFilter = document.getElementById('cityFilter').value;
  
  document.querySelectorAll('.row-checkbox').forEach(cb => {
    const row = cb.closest('tr');
    const tbody = row.closest('tbody');
    
    let visible = true;
    if (cityFilter !== 'all' && tbody.dataset.city !== cityFilter) visible = false;
    
    if (visible) {
      cb.checked = selectAll;
    }
  });
  updateSelection();
}

// ===== FILTERING =====
function filterTable() {
  const statusFilter = document.getElementById('statusFilter').value;
  const cityFilter = document.getElementById('cityFilter').value;
  const showFilter = document.getElementById('showFilter').value;
  
  document.querySelectorAll('tbody tr[data-firm]').forEach(row => {
    const tbody = row.closest('tbody');
    const firmName = row.dataset.firm;
    const firmStatus = getStatus(firmName);
    
    let visible = true;
    
    // City filter
    if (cityFilter !== 'all' && tbody.dataset.city !== cityFilter) visible = false;
    
    // Show filter (Active/Archive/All)
    if (showFilter === 'active' && (firmStatus === 'partner' || firmStatus === 'pass')) visible = false;
    if (showFilter === 'archive' && firmStatus !== 'partner' && firmStatus !== 'pass') visible = false;
    
    row.style.display = visible ? '' : 'none';
  });
  
  document.getElementById('selectAll').checked = false;
}

// ===== EMAIL MODAL =====
function updateTemplatePreview() {
  const template = document.getElementById('templateSelect').value;
  const tmpl = emailTemplates[template];
  
  document.getElementById('modalTemplateName').textContent = tmpl.name;
  document.getElementById('emailSubject').value = tmpl.subject;
  document.getElementById('emailBody').value = tmpl.body;
}

function openEmailModal() {
  if (selectedFirms.length === 0) {
    alert('Please select at least one firm to email.');
    return;
  }
  
  updateTemplatePreview();
  
  const firmsList = document.getElementById('modalFirms');
  firmsList.innerHTML = selectedFirms.map(f => 
    `<div class="modal-firm">
      <span class="modal-firm-name">${f.name}</span>
      <span class="modal-firm-email">${f.email}</span>
    </div>`
  ).join('');
  
  document.getElementById('emailModal').classList.add('active');
}

function closeEmailModal() {
  document.getElementById('emailModal').classList.remove('active');
}

function sendViaGmail() {
  const subject = encodeURIComponent(document.getElementById('emailSubject').value);
  let body = document.getElementById('emailBody').value;
  
  if (selectedFirms.length === 1) {
    const firm = selectedFirms[0];
    const personalizedBody = body.replace(/{{firm_name}}/g, firm.name)
                                  .replace(/{{contact_name}}/g, firm.contact);
    const mailto = `mailto:${firm.email}?subject=${subject}&body=${encodeURIComponent(personalizedBody)}`;
    window.open(mailto);
  } else {
    exportCSV();
    alert('Multiple firms selected. CSV downloaded for mail merge.');
  }
  
  closeEmailModal();
}

function exportCSV() {
  const template = document.getElementById('templateSelect').value;
  const subject = document.getElementById('emailSubject').value;
  const body = document.getElementById('emailBody').value;
  
  let csv = 'Firm Name,Contact Name,Email,Subject,Body,Touch Type,Touch Date\n';
  const today = new Date().toISOString().split('T')[0];
  
  selectedFirms.forEach(firm => {
    const personalizedBody = body.replace(/{{firm_name}}/g, firm.name)
                                  .replace(/{{contact_name}}/g, firm.contact);
    const touchType = template === 'touch1' ? 'Intro Email' : template === 'touch2' ? 'Follow-up Email' : 'Partner Invite';
    csv += `"${firm.name}","${firm.contact}","${firm.email}","${subject}","${personalizedBody.replace(/"/g, '""')}","${touchType}","${today}"\n`;
  });
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `tlh-campaign-${template}-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  closeEmailModal();
}

function logSends() {
  const template = document.getElementById('templateSelect').value;
  const today = new Date().toISOString().split('T')[0];
  const touchNumber = template === 'touch1' ? 1 : template === 'touch2' ? 2 : 3;
  const touchType = template === 'touch1' ? 'Intro Email' : template === 'touch2' ? 'Follow-up Email' : 'Partner Invite';
  
  // Store touches in localStorage
  const touches = getTouches();
  selectedFirms.forEach(firm => {
    if (!touches[firm.name]) touches[firm.name] = [];
    touches[firm.name].push({
      type: touchType,
      date: today,
      template: template
    });
  });
  saveTouches(touches);
  
  // Also update status if it's a touch
  const statuses = getStatuses();
  selectedFirms.forEach(firm => {
    const currentStatus = statuses[firm.name] || 'new';
    if (touchNumber === 1 && currentStatus === 'new') statuses[firm.name] = 'touch1';
    else if (touchNumber === 2 && currentStatus === 'touch1') statuses[firm.name] = 'touch2';
    else if (touchNumber === 3 && currentStatus === 'touch2') statuses[firm.name] = 'touch3';
  });
  saveStatuses(statuses);
  
  // Update UI
  selectedFirms.forEach(firm => {
    const row = document.querySelector(`tr[data-firm="${firm.name}"]`);
    if (row) {
      addStatusPillToRow(row, firm.name, statuses[firm.name] || 'touch' + touchNumber);
    }
  });
  
  renderQueue();
  renderArchive();
  
  // Try to sync to Google Sheet
  const sheetUrl = localStorage.getItem(SHEET_URL_KEY);
  if (sheetUrl) {
    fetch(sheetUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        firms: selectedFirms.map(f => ({ name: f.name })),
        touch_number: touchNumber,
        touch_type: touchType,
        date: today
      })
    }).catch(() => {});
  }
  
  alert(`ğŸ“Š Logged ${selectedFirms.length} firm(s):\n\nTouch ${touchNumber}: ${touchType}\nDate: ${today}\n\nStatus updated and Queue refreshed.`);
  
  closeEmailModal();
}

// ===== QUEUE EMAIL MODAL =====
function openQueueEmailModal() {
  // Get overdue and new firms
  const firms = getAllFirms().filter(f => {
    const priority = getQueuePriority(f.name);
    return priority === 1 || priority === 2;
  });
  
  if (firms.length === 0) {
    alert('No overdue or new firms to contact.');
    return;
  }
  
  selectedFirms = firms.map(f => ({
    name: f.name,
    email: f.email,
    contact: f.contact
  }));
  
  updateTemplatePreview();
  
  const firmsList = document.getElementById('modalFirms');
  firmsList.innerHTML = selectedFirms.map(f => 
    `<div class="modal-firm">
      <span class="modal-firm-name">${f.name}</span>
      <span class="modal-firm-email">${f.email}</span>
    </div>`
  ).join('');
  
  document.getElementById('emailModal').classList.add('active');
}

// Close modal on escape
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeEmailModal();
});
</script>
</body>
</html>
