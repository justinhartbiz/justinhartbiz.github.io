<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2025 AdWords Marketing Funnel Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}
.header{background:linear-gradient(135deg,#1e293b 0%,#334155 100%);padding:24px 32px;border-bottom:2px solid #3b82f6}
.header h1{font-size:24px;font-weight:700;color:#f8fafc}
.header p{color:#94a3b8;font-size:14px;margin-top:4px}
.container{max-width:1400px;margin:0 auto;padding:24px}
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:24px}
.kpi-card{background:#1e293b;border-radius:12px;padding:20px;border:1px solid #334155;transition:transform .2s}
.kpi-card:hover{transform:translateY(-2px);border-color:#3b82f6}
.kpi-label{font-size:12px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.kpi-value{font-size:28px;font-weight:700;color:#f8fafc}
.kpi-value.cost{color:#f87171}
.kpi-value.good{color:#34d399}
.tabs{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap}
.tab{padding:10px 20px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;background:#1e293b;border:1px solid #334155;color:#94a3b8;transition:all .2s}
.tab:hover,.tab.active{background:#3b82f6;color:#fff;border-color:#3b82f6}
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
.chart-card{background:#1e293b;border-radius:12px;padding:20px;border:1px solid #334155}
.chart-card.full{grid-column:1/-1}
.chart-title{font-size:16px;font-weight:600;color:#f8fafc;margin-bottom:16px}
.table-wrap{overflow-x:auto;margin-top:16px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:#334155;color:#e2e8f0;padding:10px 12px;text-align:right;font-weight:600;position:sticky;top:0}
th:first-child{text-align:left}
td{padding:10px 12px;border-bottom:1px solid #1e293b;text-align:right;color:#cbd5e1}
td:first-child{text-align:left;font-weight:500;color:#f8fafc}
tr:hover td{background:#1e293b}
tr:nth-child(even) td{background:rgba(51,65,85,.3)}
.county-pills{display:flex;gap:8px;margin-bottom:16px}
.pill{padding:6px 14px;border-radius:20px;font-size:13px;cursor:pointer;border:1px solid #475569;color:#94a3b8;transition:all .2s}
.pill:hover,.pill.active{border-color:#3b82f6;color:#3b82f6;background:rgba(59,130,246,.1)}
.funnel-viz{display:flex;flex-direction:column;align-items:center;gap:4px;padding:20px}
.funnel-step{display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:14px;border-radius:6px;transition:all .3s;cursor:default;position:relative}
.funnel-step:hover{transform:scale(1.02)}
.funnel-step .label{position:absolute;right:-180px;color:#94a3b8;font-size:12px;font-weight:400;white-space:nowrap}
.total-row td{font-weight:700!important;background:#334155!important;color:#f8fafc!important}
@media(max-width:900px){.kpi-row{grid-template-columns:repeat(2,1fr)}.chart-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="header">
<h1>2025 AdWords Marketing Funnel</h1>
<p>January — December 2025 &nbsp;|&nbsp; Los Angeles, Orange County, San Diego</p>
</div>

<div class="container">

<!-- KPI Cards -->
<div class="kpi-row" id="kpiRow"></div>

<!-- Tabs -->
<div class="tabs" id="mainTabs">
<div class="tab active" data-tab="overview">Overview</div>
<div class="tab" data-tab="monthly">Monthly Trend</div>
<div class="tab" data-tab="county">County Detail</div>
<div class="tab" data-tab="costs">Cost Analysis</div>
<div class="tab" data-tab="table">Data Tables</div>
</div>

<!-- Tab content -->
<div id="tabContent"></div>

</div>

<script>
const DATA = {"summary": [{"Month": "Jan", "MonthNum": 1, "Spend": 24498.85, "TotalLeads": 359, "QualifiedLeads": 62, "Opportunities": 65, "ClosedWon": 8, "CPL": 68.24, "CPQL": 395.14, "CPO": 376.91, "CPW": 3062.36}, {"Month": "Feb", "MonthNum": 2, "Spend": 13823.0, "TotalLeads": 299, "QualifiedLeads": 45, "Opportunities": 43, "ClosedWon": 11, "CPL": 46.23, "CPQL": 307.18, "CPO": 321.47, "CPW": 1256.64}, {"Month": "Mar", "MonthNum": 3, "Spend": 29894.06, "TotalLeads": 344, "QualifiedLeads": 63, "Opportunities": 63, "ClosedWon": 19, "CPL": 86.9, "CPQL": 474.51, "CPO": 474.51, "CPW": 1573.37}, {"Month": "Apr", "MonthNum": 4, "Spend": 27218.24, "TotalLeads": 338, "QualifiedLeads": 63, "Opportunities": 64, "ClosedWon": 15, "CPL": 80.53, "CPQL": 432.04, "CPO": 425.28, "CPW": 1814.55}, {"Month": "May", "MonthNum": 5, "Spend": 31045.97, "TotalLeads": 314, "QualifiedLeads": 51, "Opportunities": 48, "ClosedWon": 14, "CPL": 98.87, "CPQL": 608.74, "CPO": 646.79, "CPW": 2217.57}, {"Month": "Jun", "MonthNum": 6, "Spend": 43653.06, "TotalLeads": 370, "QualifiedLeads": 50, "Opportunities": 52, "ClosedWon": 10, "CPL": 117.98, "CPQL": 873.06, "CPO": 839.48, "CPW": 4365.31}, {"Month": "Jul", "MonthNum": 7, "Spend": 33887.86, "TotalLeads": 378, "QualifiedLeads": 64, "Opportunities": 68, "ClosedWon": 27, "CPL": 89.65, "CPQL": 529.5, "CPO": 498.35, "CPW": 1255.11}, {"Month": "Aug", "MonthNum": 8, "Spend": 42300.66, "TotalLeads": 393, "QualifiedLeads": 66, "Opportunities": 63, "ClosedWon": 20, "CPL": 107.64, "CPQL": 640.92, "CPO": 671.44, "CPW": 2115.03}, {"Month": "Sep", "MonthNum": 9, "Spend": 33281.48, "TotalLeads": 364, "QualifiedLeads": 64, "Opportunities": 65, "ClosedWon": 16, "CPL": 91.43, "CPQL": 520.02, "CPO": 512.02, "CPW": 2080.09}, {"Month": "Oct", "MonthNum": 10, "Spend": 41079.02, "TotalLeads": 552, "QualifiedLeads": 74, "Opportunities": 74, "ClosedWon": 15, "CPL": 74.42, "CPQL": 555.12, "CPO": 555.12, "CPW": 2738.6}, {"Month": "Nov", "MonthNum": 11, "Spend": 36177.59, "TotalLeads": 610, "QualifiedLeads": 45, "Opportunities": 49, "ClosedWon": 14, "CPL": 59.31, "CPQL": 803.95, "CPO": 738.32, "CPW": 2584.11}, {"Month": "Dec", "MonthNum": 12, "Spend": 34494.13, "TotalLeads": 319, "QualifiedLeads": 24, "Opportunities": 27, "ClosedWon": 8, "CPL": 108.13, "CPQL": 1437.26, "CPO": 1277.56, "CPW": 4311.77}], "county_monthly": [{"County": "Los Angeles", "Month": "Jan", "MonthNum": 1, "Spend": 4641.21, "QualifiedLeads": 10, "Opportunities": 8, "ClosedWon": 0, "CPQL": 464.12, "CPO": 580.15, "CPW": 0.0}, {"County": "Los Angeles", "Month": "Feb", "MonthNum": 2, "Spend": 1962.21, "QualifiedLeads": 1, "Opportunities": 2, "ClosedWon": 1, "CPQL": 1962.21, "CPO": 981.1, "CPW": 1962.21}, {"County": "Los Angeles", "Month": "Mar", "MonthNum": 3, "Spend": 3296.63, "QualifiedLeads": 8, "Opportunities": 9, "ClosedWon": 2, "CPQL": 412.08, "CPO": 366.29, "CPW": 1648.31}, {"County": "Los Angeles", "Month": "Apr", "MonthNum": 4, "Spend": 3318.54, "QualifiedLeads": 4, "Opportunities": 4, "ClosedWon": 0, "CPQL": 829.64, "CPO": 829.64, "CPW": 0.0}, {"County": "Los Angeles", "Month": "May", "MonthNum": 5, "Spend": 5410.66, "QualifiedLeads": 4, "Opportunities": 3, "ClosedWon": 0, "CPQL": 1352.66, "CPO": 1803.55, "CPW": 0.0}, {"County": "Los Angeles", "Month": "Jun", "MonthNum": 6, "Spend": 10071.69, "QualifiedLeads": 6, "Opportunities": 5, "ClosedWon": 1, "CPQL": 1678.62, "CPO": 2014.34, "CPW": 10071.69}, {"County": "Los Angeles", "Month": "Jul", "MonthNum": 7, "Spend": 11418.62, "QualifiedLeads": 10, "Opportunities": 10, "ClosedWon": 4, "CPQL": 1141.86, "CPO": 1141.86, "CPW": 2854.66}, {"County": "Los Angeles", "Month": "Aug", "MonthNum": 8, "Spend": 10802.2, "QualifiedLeads": 9, "Opportunities": 10, "ClosedWon": 2, "CPQL": 1200.24, "CPO": 1080.22, "CPW": 5401.1}, {"County": "Los Angeles", "Month": "Sep", "MonthNum": 9, "Spend": 10671.07, "QualifiedLeads": 6, "Opportunities": 6, "ClosedWon": 3, "CPQL": 1778.51, "CPO": 1778.51, "CPW": 3557.02}, {"County": "Los Angeles", "Month": "Oct", "MonthNum": 10, "Spend": 10400.92, "QualifiedLeads": 10, "Opportunities": 11, "ClosedWon": 1, "CPQL": 1040.09, "CPO": 945.54, "CPW": 10400.92}, {"County": "Los Angeles", "Month": "Nov", "MonthNum": 11, "Spend": 8576.42, "QualifiedLeads": 8, "Opportunities": 7, "ClosedWon": 4, "CPQL": 1072.05, "CPO": 1225.2, "CPW": 2144.1}, {"County": "Los Angeles", "Month": "Dec", "MonthNum": 12, "Spend": 11455.32, "QualifiedLeads": 4, "Opportunities": 5, "ClosedWon": 4, "CPQL": 2863.83, "CPO": 2291.06, "CPW": 2863.83}, {"County": "Orange County", "Month": "Jan", "MonthNum": 1, "Spend": 9954.12, "QualifiedLeads": 20, "Opportunities": 21, "ClosedWon": 2, "CPQL": 497.71, "CPO": 474.01, "CPW": 4977.06}, {"County": "Orange County", "Month": "Feb", "MonthNum": 2, "Spend": 5752.43, "QualifiedLeads": 13, "Opportunities": 15, "ClosedWon": 4, "CPQL": 442.49, "CPO": 383.5, "CPW": 1438.11}, {"County": "Orange County", "Month": "Mar", "MonthNum": 3, "Spend": 16810.59, "QualifiedLeads": 15, "Opportunities": 11, "ClosedWon": 2, "CPQL": 1120.71, "CPO": 1528.24, "CPW": 8405.3}, {"County": "Orange County", "Month": "Apr", "MonthNum": 4, "Spend": 12321.67, "QualifiedLeads": 23, "Opportunities": 25, "ClosedWon": 1, "CPQL": 535.72, "CPO": 492.87, "CPW": 12321.67}, {"County": "Orange County", "Month": "May", "MonthNum": 5, "Spend": 12557.24, "QualifiedLeads": 23, "Opportunities": 24, "ClosedWon": 7, "CPQL": 545.97, "CPO": 523.22, "CPW": 1793.89}, {"County": "Orange County", "Month": "Jun", "MonthNum": 6, "Spend": 12470.46, "QualifiedLeads": 17, "Opportunities": 16, "ClosedWon": 1, "CPQL": 733.56, "CPO": 779.4, "CPW": 12470.46}, {"County": "Orange County", "Month": "Jul", "MonthNum": 7, "Spend": 9979.26, "QualifiedLeads": 24, "Opportunities": 25, "ClosedWon": 9, "CPQL": 415.8, "CPO": 399.17, "CPW": 1108.81}, {"County": "Orange County", "Month": "Aug", "MonthNum": 8, "Spend": 9845.07, "QualifiedLeads": 20, "Opportunities": 18, "ClosedWon": 4, "CPQL": 492.25, "CPO": 546.95, "CPW": 2461.27}, {"County": "Orange County", "Month": "Sep", "MonthNum": 9, "Spend": 7894.05, "QualifiedLeads": 20, "Opportunities": 19, "ClosedWon": 0, "CPQL": 394.7, "CPO": 415.48, "CPW": 0.0}, {"County": "Orange County", "Month": "Oct", "MonthNum": 10, "Spend": 15303.97, "QualifiedLeads": 17, "Opportunities": 17, "ClosedWon": 3, "CPQL": 900.23, "CPO": 900.23, "CPW": 5101.32}, {"County": "Orange County", "Month": "Nov", "MonthNum": 11, "Spend": 15960.69, "QualifiedLeads": 19, "Opportunities": 22, "ClosedWon": 3, "CPQL": 840.04, "CPO": 725.49, "CPW": 5320.23}, {"County": "Orange County", "Month": "Dec", "MonthNum": 12, "Spend": 12210.5, "QualifiedLeads": 7, "Opportunities": 7, "ClosedWon": 0, "CPQL": 1744.36, "CPO": 1744.36, "CPW": 0.0}, {"County": "San Diego", "Month": "Jan", "MonthNum": 1, "Spend": 9903.52, "QualifiedLeads": 32, "Opportunities": 36, "ClosedWon": 6, "CPQL": 309.48, "CPO": 275.1, "CPW": 1650.59}, {"County": "San Diego", "Month": "Feb", "MonthNum": 2, "Spend": 6108.36, "QualifiedLeads": 31, "Opportunities": 26, "ClosedWon": 6, "CPQL": 197.04, "CPO": 234.94, "CPW": 1018.06}, {"County": "San Diego", "Month": "Mar", "MonthNum": 3, "Spend": 9786.84, "QualifiedLeads": 39, "Opportunities": 42, "ClosedWon": 14, "CPQL": 250.94, "CPO": 233.02, "CPW": 699.06}, {"County": "San Diego", "Month": "Apr", "MonthNum": 4, "Spend": 11578.03, "QualifiedLeads": 36, "Opportunities": 35, "ClosedWon": 14, "CPQL": 321.61, "CPO": 330.8, "CPW": 827.0}, {"County": "San Diego", "Month": "May", "MonthNum": 5, "Spend": 13078.07, "QualifiedLeads": 23, "Opportunities": 21, "ClosedWon": 7, "CPQL": 568.61, "CPO": 622.77, "CPW": 1868.3}, {"County": "San Diego", "Month": "Jun", "MonthNum": 6, "Spend": 21110.91, "QualifiedLeads": 26, "Opportunities": 30, "ClosedWon": 8, "CPQL": 811.96, "CPO": 703.7, "CPW": 2638.86}, {"County": "San Diego", "Month": "Jul", "MonthNum": 7, "Spend": 12489.98, "QualifiedLeads": 28, "Opportunities": 31, "ClosedWon": 14, "CPQL": 446.07, "CPO": 402.9, "CPW": 892.14}, {"County": "San Diego", "Month": "Aug", "MonthNum": 8, "Spend": 21653.39, "QualifiedLeads": 37, "Opportunities": 35, "ClosedWon": 14, "CPQL": 585.23, "CPO": 618.67, "CPW": 1546.67}, {"County": "San Diego", "Month": "Sep", "MonthNum": 9, "Spend": 14716.36, "QualifiedLeads": 38, "Opportunities": 40, "ClosedWon": 13, "CPQL": 387.27, "CPO": 367.91, "CPW": 1132.03}, {"County": "San Diego", "Month": "Oct", "MonthNum": 10, "Spend": 15374.13, "QualifiedLeads": 46, "Opportunities": 46, "ClosedWon": 11, "CPQL": 334.22, "CPO": 334.22, "CPW": 1397.65}, {"County": "San Diego", "Month": "Nov", "MonthNum": 11, "Spend": 11640.48, "QualifiedLeads": 18, "Opportunities": 20, "ClosedWon": 7, "CPQL": 646.69, "CPO": 582.02, "CPW": 1662.93}, {"County": "San Diego", "Month": "Dec", "MonthNum": 12, "Spend": 10828.31, "QualifiedLeads": 13, "Opportunities": 15, "ClosedWon": 4, "CPQL": 832.95, "CPO": 721.89, "CPW": 2707.08}], "county_annual": [{"County": "Los Angeles", "Spend": 92025.49, "QualifiedLeads": 80, "Opportunities": 80, "ClosedWon": 22, "CPQL": 1150.32, "CPO": 1150.32, "CPW": 4182.98}, {"County": "Orange County", "Spend": 141060.05, "QualifiedLeads": 218, "Opportunities": 220, "ClosedWon": 36, "CPQL": 647.06, "CPO": 641.18, "CPW": 3918.33}, {"County": "San Diego", "Spend": 158268.38, "QualifiedLeads": 367, "Opportunities": 377, "ClosedWon": 118, "CPQL": 431.25, "CPO": 419.81, "CPW": 1341.26}], "annual_totals": {"spend": 391353.92, "leads": 4640, "qualified": 671, "opportunities": 681, "won": 177, "cpl": 84.34, "cpql": 583.24, "cpo": 574.68, "cpw": 2211.04}};

const fmt = n => '$' + n.toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});
const fmtD = n => '$' + n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const fmtN = n => n.toLocaleString('en-US');
const COLORS = {LA:'#3b82f6',OC:'#f59e0b',SD:'#10b981'};
const COUNTY_COLORS = {'Los Angeles':'#3b82f6','Orange County':'#f59e0b','San Diego':'#10b981'};
const months = DATA.summary.map(r=>r.Month);
let charts = {};

function destroyCharts(){Object.values(charts).forEach(c=>{try{c.destroy()}catch(e){}});charts={}}

function renderKPIs(){
  const a = DATA.annual_totals;
  const kpis = [
    {label:'Total Ad Spend',value:fmt(a.spend),cls:''},
    {label:'Total Leads',value:fmtN(a.leads),cls:'good'},
    {label:'Qualified Leads',value:fmtN(a.qualified),cls:'good'},
    {label:'Opportunities',value:fmtN(a.opportunities),cls:'good'},
    {label:'Closed Won',value:fmtN(a.won),cls:'good'}
  ];
  document.getElementById('kpiRow').innerHTML = kpis.map(k=>`
    <div class="kpi-card"><div class="kpi-label">${k.label}</div><div class="kpi-value ${k.cls}">${k.value}</div></div>
  `).join('');
}

function renderOverview(){
  const a = DATA.annual_totals;
  return `
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-title">Annual Funnel</div>
        <div class="funnel-viz" id="funnelViz"></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Cost Per Stage</div>
        <canvas id="costBarChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-title">Spend by County</div>
        <canvas id="spendPieChart"></canvas>
      </div>
      <div class="chart-card">
        <div class="chart-title">Wins by County</div>
        <canvas id="winsPieChart"></canvas>
      </div>
    </div>
  `;
}

function initOverview(){
  const a = DATA.annual_totals;
  // Funnel
  const steps = [
    {label:'Ad Spend',value:fmt(a.spend),count:null,color:'#6366f1',width:100},
    {label:'Total Leads',value:fmtN(a.leads),count:a.leads,color:'#3b82f6',width:85},
    {label:'Qualified Leads',value:fmtN(a.qualified),count:a.qualified,color:'#0ea5e9',width:60},
    {label:'Opportunities',value:fmtN(a.opportunities),count:a.opportunities,color:'#14b8a6',width:50},
    {label:'Closed Won',value:fmtN(a.won),count:a.won,color:'#10b981',width:30}
  ];
  const fv = document.getElementById('funnelViz');
  fv.innerHTML = steps.map(s=>`
    <div class="funnel-step" style="width:${s.width}%;height:48px;background:${s.color}">
      ${s.label}: ${s.value}
    </div>
  `).join('');

  // Cost bar
  charts.costBar = new Chart(document.getElementById('costBarChart'),{
    type:'bar',
    data:{
      labels:['Cost/Lead','Cost/Qualified','Cost/Opp','Cost/Win'],
      datasets:[{data:[a.cpl,a.cpql,a.cpo,a.cpw],backgroundColor:['#6366f1','#3b82f6','#14b8a6','#10b981'],borderRadius:6}]
    },
    options:{responsive:true,plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>fmtD(ctx.raw)}}},scales:{y:{ticks:{callback:v=>'$'+v,color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });

  // Spend pie
  const ca = DATA.county_annual;
  charts.spendPie = new Chart(document.getElementById('spendPieChart'),{
    type:'doughnut',
    data:{labels:ca.map(r=>r.County),datasets:[{data:ca.map(r=>r.Spend),backgroundColor:ca.map(r=>COUNTY_COLORS[r.County])}]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>ctx.label+': '+fmt(ctx.raw)}}}}
  });

  charts.winsPie = new Chart(document.getElementById('winsPieChart'),{
    type:'doughnut',
    data:{labels:ca.map(r=>r.County),datasets:[{data:ca.map(r=>r.ClosedWon),backgroundColor:ca.map(r=>COUNTY_COLORS[r.County])}]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>ctx.label+': '+ctx.raw+' wins'}}}}
  });
}

function renderMonthly(){
  return `
    <div class="chart-grid">
      <div class="chart-card full"><div class="chart-title">Monthly Ad Spend</div><canvas id="spendLineChart"></canvas></div>
      <div class="chart-card full"><div class="chart-title">Monthly Funnel Volume</div><canvas id="funnelLineChart"></canvas></div>
    </div>
  `;
}

function initMonthly(){
  const s = DATA.summary;
  charts.spendLine = new Chart(document.getElementById('spendLineChart'),{
    type:'line',
    data:{labels:months,datasets:[{label:'Ad Spend',data:s.map(r=>r.Spend),borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,.1)',fill:true,tension:.3,pointRadius:4}]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>fmtD(ctx.raw)}}},scales:{y:{ticks:{callback:v=>'$'+v.toLocaleString(),color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });

  charts.funnelLine = new Chart(document.getElementById('funnelLineChart'),{
    type:'line',
    data:{labels:months,datasets:[
      {label:'Total Leads',data:s.map(r=>r.TotalLeads),borderColor:'#3b82f6',tension:.3,pointRadius:3},
      {label:'Qualified',data:s.map(r=>r.QualifiedLeads),borderColor:'#0ea5e9',tension:.3,pointRadius:3},
      {label:'Opportunities',data:s.map(r=>r.Opportunities),borderColor:'#14b8a6',tension:.3,pointRadius:3},
      {label:'Closed Won',data:s.map(r=>r.ClosedWon),borderColor:'#10b981',tension:.3,pointRadius:3}
    ]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}}},scales:{y:{ticks:{color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });
}

function renderCounty(){
  return `
    <div class="county-pills" id="countyPills">
      <div class="pill active" data-county="all">All Counties</div>
      <div class="pill" data-county="Los Angeles">Los Angeles</div>
      <div class="pill" data-county="Orange County">Orange County</div>
      <div class="pill" data-county="San Diego">San Diego</div>
    </div>
    <div class="chart-grid">
      <div class="chart-card full"><div class="chart-title">Spend by County by Month</div><canvas id="countySpendChart"></canvas></div>
      <div class="chart-card"><div class="chart-title">Qualified Leads by County</div><canvas id="countyQualChart"></canvas></div>
      <div class="chart-card"><div class="chart-title">Closed Won by County</div><canvas id="countyWonChart"></canvas></div>
    </div>
  `;
}

function initCounty(){
  const cm = DATA.county_monthly;
  const counties = ['Los Angeles','Orange County','San Diego'];

  const makeDS = (county,field) => ({
    label:county,
    data:months.map((_,i)=>{const r=cm.find(x=>x.County===county&&x.MonthNum===i+1);return r?r[field]:0}),
    borderColor:COUNTY_COLORS[county],backgroundColor:COUNTY_COLORS[county]+'33',
    tension:.3,pointRadius:3
  });

  charts.countySpend = new Chart(document.getElementById('countySpendChart'),{
    type:'bar',
    data:{labels:months,datasets:counties.map(c=>({label:c,data:months.map((_,i)=>{const r=cm.find(x=>x.County===c&&x.MonthNum===i+1);return r?r.Spend:0}),backgroundColor:COUNTY_COLORS[c],borderRadius:4}))},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+fmtD(ctx.raw)}}},scales:{x:{stacked:true,ticks:{color:'#94a3b8'},grid:{display:false}},y:{stacked:true,ticks:{callback:v=>'$'+v.toLocaleString(),color:'#94a3b8'},grid:{color:'#1e293b'}}}}
  });

  charts.countyQual = new Chart(document.getElementById('countyQualChart'),{
    type:'line',data:{labels:months,datasets:counties.map(c=>makeDS(c,'QualifiedLeads'))},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}}},scales:{y:{ticks:{color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });

  charts.countyWon = new Chart(document.getElementById('countyWonChart'),{
    type:'line',data:{labels:months,datasets:counties.map(c=>makeDS(c,'ClosedWon'))},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}}},scales:{y:{ticks:{color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });
}

function renderCosts(){
  return `
    <div class="chart-grid">
      <div class="chart-card full"><div class="chart-title">Cost Per Lead & Cost Per Win — Monthly Trend</div><canvas id="cplCpwChart"></canvas></div>
      <div class="chart-card full"><div class="chart-title">Cost Per Win by County — Monthly</div><canvas id="cpwCountyChart"></canvas></div>
    </div>
  `;
}

function initCosts(){
  const s = DATA.summary;
  charts.cplCpw = new Chart(document.getElementById('cplCpwChart'),{
    type:'line',
    data:{labels:months,datasets:[
      {label:'Cost/Lead',data:s.map(r=>r.CPL),borderColor:'#3b82f6',tension:.3,pointRadius:3,yAxisID:'y'},
      {label:'Cost/Win',data:s.map(r=>r.CPW),borderColor:'#f87171',tension:.3,pointRadius:3,yAxisID:'y1'}
    ]},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+fmtD(ctx.raw)}}},
      scales:{y:{position:'left',title:{display:true,text:'Cost/Lead',color:'#94a3b8'},ticks:{callback:v=>'$'+v,color:'#94a3b8'},grid:{color:'#1e293b'}},
              y1:{position:'right',title:{display:true,text:'Cost/Win',color:'#94a3b8'},ticks:{callback:v=>'$'+v,color:'#94a3b8'},grid:{display:false}},
              x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });

  const cm = DATA.county_monthly;
  const counties = ['Los Angeles','Orange County','San Diego'];
  charts.cpwCounty = new Chart(document.getElementById('cpwCountyChart'),{
    type:'line',
    data:{labels:months,datasets:counties.map(c=>({
      label:c,
      data:months.map((_,i)=>{const r=cm.find(x=>x.County===c&&x.MonthNum===i+1);return r?r.CPW:0}),
      borderColor:COUNTY_COLORS[c],tension:.3,pointRadius:3
    }))},
    options:{responsive:true,plugins:{legend:{labels:{color:'#e2e8f0'}},tooltip:{callbacks:{label:ctx=>ctx.dataset.label+': '+fmtD(ctx.raw)}}},
      scales:{y:{ticks:{callback:v=>'$'+v.toLocaleString(),color:'#94a3b8'},grid:{color:'#1e293b'}},x:{ticks:{color:'#94a3b8'},grid:{display:false}}}}
  });
}

function renderTable(){
  const s = DATA.summary;
  const ca = DATA.county_annual;
  const a = DATA.annual_totals;
  let html = `<div class="chart-card full"><div class="chart-title">Monthly Summary — All Counties</div><div class="table-wrap"><table>
    <tr><th>Month</th><th>Ad Spend</th><th>Leads</th><th>Qualified</th><th>Opps</th><th>Won</th><th>CPL</th><th>CPQL</th><th>CPO</th><th>CPW</th></tr>`;
  s.forEach(r=>{html+=`<tr><td>${r.Month}</td><td>${fmtD(r.Spend)}</td><td>${fmtN(r.TotalLeads)}</td><td>${fmtN(r.QualifiedLeads)}</td><td>${fmtN(r.Opportunities)}</td><td>${fmtN(r.ClosedWon)}</td><td>${fmtD(r.CPL)}</td><td>${fmtD(r.CPQL)}</td><td>${fmtD(r.CPO)}</td><td>${fmtD(r.CPW)}</td></tr>`});
  html+=`<tr class="total-row"><td>TOTAL</td><td>${fmtD(a.spend)}</td><td>${fmtN(a.leads)}</td><td>${fmtN(a.qualified)}</td><td>${fmtN(a.opportunities)}</td><td>${fmtN(a.won)}</td><td>${fmtD(a.cpl)}</td><td>${fmtD(a.cpql)}</td><td>${fmtD(a.cpo)}</td><td>${fmtD(a.cpw)}</td></tr>`;
  html+=`</table></div></div>`;

  // County tables
  ['Los Angeles','Orange County','San Diego'].forEach(county=>{
    const cd = DATA.county_monthly.filter(r=>r.County===county);
    const tot = ca.find(r=>r.County===county);
    html+=`<div class="chart-card full" style="margin-top:16px"><div class="chart-title">${county}</div><div class="table-wrap"><table>
      <tr><th>Month</th><th>Ad Spend</th><th>Qualified</th><th>Opps</th><th>Won</th><th>CPQL</th><th>CPO</th><th>CPW</th></tr>`;
    cd.forEach(r=>{html+=`<tr><td>${r.Month}</td><td>${fmtD(r.Spend)}</td><td>${fmtN(r.QualifiedLeads)}</td><td>${fmtN(r.Opportunities)}</td><td>${fmtN(r.ClosedWon)}</td><td>${fmtD(r.CPQL)}</td><td>${fmtD(r.CPO)}</td><td>${r.CPW?fmtD(r.CPW):'—'}</td></tr>`});
    if(tot) html+=`<tr class="total-row"><td>TOTAL</td><td>${fmtD(tot.Spend)}</td><td>${fmtN(tot.QualifiedLeads)}</td><td>${fmtN(tot.Opportunities)}</td><td>${fmtN(tot.ClosedWon)}</td><td>${fmtD(tot.CPQL)}</td><td>${fmtD(tot.CPO)}</td><td>${fmtD(tot.CPW)}</td></tr>`;
    html+=`</table></div></div>`;
  });

  return html;
}

// Tab navigation
const tabContent = document.getElementById('tabContent');
const renderers = {overview:renderOverview,monthly:renderMonthly,county:renderCounty,costs:renderCosts,table:renderTable};
const initializers = {overview:initOverview,monthly:initMonthly,county:initCounty,costs:initCosts};

function switchTab(tab){
  destroyCharts();
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===tab));
  tabContent.innerHTML = renderers[tab]();
  if(initializers[tab]) initializers[tab]();
}

document.getElementById('mainTabs').addEventListener('click',e=>{
  const tab = e.target.dataset.tab;
  if(tab) switchTab(tab);
});

renderKPIs();
switchTab('overview');
</script>

</body>
</html>
