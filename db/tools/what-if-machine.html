<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÆ The What If Machine</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-input: #16162a;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 0.5rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Input Section */
        .input-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .input-label {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .char-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: normal;
        }

        .char-count.warning { color: var(--accent-orange); }
        .char-count.danger { color: var(--accent-red); }

        textarea {
            width: 100%;
            min-height: 200px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        textarea::placeholder {
            color: var(--text-secondary);
        }

        /* API Key Section */
        .api-section {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .api-input-group {
            flex: 1;
            min-width: 250px;
        }

        .api-input-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .api-input-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 1.25rem 2rem;
            margin-top: 1.5rem;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            border: none;
            border-radius: 0.75rem;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .generate-btn .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        .generate-btn.loading .spinner {
            display: block;
        }

        .generate-btn.loading .btn-text {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Strategy Pills */
        .strategies-header {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .strategy-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .strategy-pill {
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .strategy-pill.urgency { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .strategy-pill.emotion { background: rgba(236, 72, 153, 0.2); color: #f9a8d4; }
        .strategy-pill.shorter { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }
        .strategy-pill.longer { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        .strategy-pill.voice { background: rgba(139, 92, 246, 0.2); color: #c4b5fd; }
        .strategy-pill.ask { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .strategy-pill.question { background: rgba(6, 182, 212, 0.2); color: #67e8f9; }
        .strategy-pill.story { background: rgba(168, 85, 247, 0.2); color: #d8b4fe; }
        .strategy-pill.fear { background: rgba(244, 63, 94, 0.2); color: #fda4af; }
        .strategy-pill.gratitude { background: rgba(34, 197, 94, 0.2); color: #86efac; }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.visible {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .copy-all-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border: 2px solid var(--accent-purple);
            border-radius: 0.5rem;
            color: var(--accent-purple);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-all-btn:hover {
            background: var(--accent-purple);
            color: white;
        }

        /* Variation Cards */
        .variations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .variation-card {
            background: var(--bg-card);
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .variation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .variation-header {
            padding: 1rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }

        .variation-title {
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .variation-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .variation-chars {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: 'SF Mono', Monaco, monospace;
        }

        .variation-chars.short { color: var(--accent-green); }
        .variation-chars.medium { color: var(--accent-orange); }
        .variation-chars.long { color: var(--accent-red); }

        .copy-btn {
            padding: 0.4rem 0.8rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 0.4rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            border-color: var(--accent-purple);
            color: var(--accent-purple);
        }

        .copy-btn.copied {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }

        .variation-body {
            padding: 1.25rem;
        }

        .variation-text {
            white-space: pre-wrap;
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .variation-strategy {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 15, 26, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.visible {
            display: flex;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .loading-strategy {
            margin-top: 0.5rem;
            font-size: 1rem;
            color: var(--accent-purple);
        }

        /* Error State */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            color: #fca5a5;
            margin-top: 1rem;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .variations-grid {
                grid-template-columns: 1fr;
            }

            .api-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">üîÆ</div>
            <h1>The What If Machine</h1>
            <p class="subtitle">Transform winning creative into 10 A/B test variations instantly</p>
        </header>

        <section class="input-section">
            <div class="input-header">
                <label class="input-label">
                    ‚ú® Paste Your Winning Creative
                    <span class="char-count" id="inputCharCount">0 chars</span>
                </label>
            </div>
            <textarea 
                id="creativeInput" 
                placeholder="Paste your best-performing fundraising copy here...

Example:
Friend, time is running out. Our February deadline hits in just 72 hours, and we're still $12,847 short.

I hate to say it, but if we don't close this gap, we'll have to cancel our upcoming veteran support event. That means 200 heroes won't get the help they need.

Can you rush $25 right now? Every dollar matched 2X until midnight."
            ></textarea>

            <div class="strategies-header">üìä Variation Strategies:</div>
            <div class="strategy-pills">
                <span class="strategy-pill urgency">üî• Stronger Urgency</span>
                <span class="strategy-pill emotion">üíî Different Emotion</span>
                <span class="strategy-pill shorter">‚úÇÔ∏è Shorter Version</span>
                <span class="strategy-pill longer">üìù Longer Version</span>
                <span class="strategy-pill voice">üé≠ Different Voice</span>
                <span class="strategy-pill ask">üí∞ Different Ask</span>
                <span class="strategy-pill question">‚ùì Question Lead</span>
                <span class="strategy-pill story">üìñ Story Lead</span>
                <span class="strategy-pill fear">üò∞ Fear Angle</span>
                <span class="strategy-pill gratitude">üôè Gratitude Angle</span>
            </div>

            <div class="api-section">
                <div class="api-input-group">
                    <label>OpenAI API Key (required)</label>
                    <input type="password" id="apiKey" placeholder="sk-..." />
                </div>
                <div class="api-input-group">
                    <label>Model (optional)</label>
                    <input type="text" id="modelName" placeholder="gpt-4o-mini" value="gpt-4o-mini" />
                </div>
            </div>

            <button class="generate-btn" id="generateBtn" onclick="generateVariations()">
                <span class="spinner"></span>
                <span class="btn-text">üöÄ Generate 10 Variations</span>
            </button>

            <div class="error-message" id="errorMessage"></div>
        </section>

        <section class="results-section" id="resultsSection">
            <div class="results-header">
                <h2 class="results-title">üìã Your Variations</h2>
                <button class="copy-all-btn" onclick="copyAllVariations()">üìã Copy All</button>
            </div>
            <div class="variations-grid" id="variationsGrid"></div>
        </section>

        <footer class="footer">
            Built with üîÆ for fundraising excellence ‚Ä¢ What If Machine v1.0
        </footer>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Generating variations...</div>
            <div class="loading-strategy" id="loadingStrategy">üî• Creating urgency variant</div>
        </div>
    </div>

    <script>
        // Character counter
        const creativeInput = document.getElementById('creativeInput');
        const charCount = document.getElementById('inputCharCount');

        creativeInput.addEventListener('input', () => {
            const len = creativeInput.value.length;
            charCount.textContent = `${len} chars`;
            charCount.className = 'char-count';
            if (len > 1000) charCount.classList.add('warning');
            if (len > 2000) charCount.classList.add('danger');
        });

        // Load saved API key
        const savedKey = localStorage.getItem('whatif_apikey');
        if (savedKey) {
            document.getElementById('apiKey').value = savedKey;
        }

        // Strategy configurations
        const strategies = [
            {
                id: 'urgency',
                name: 'üî• Stronger Urgency',
                class: 'urgency',
                prompt: 'Create a version with MUCH stronger urgency. Add a harder deadline, scarcity, or countdown. Make the reader feel they must act RIGHT NOW or something bad happens.'
            },
            {
                id: 'emotion',
                name: 'üíî Different Emotion',
                class: 'emotion',
                prompt: 'Rewrite using a completely different emotional angle. If the original uses fear, try hope. If it uses guilt, try pride. Change the core emotional driver while keeping the ask.'
            },
            {
                id: 'shorter',
                name: '‚úÇÔ∏è Shorter Version',
                class: 'shorter',
                prompt: 'Create a MUCH shorter version - aim for 50% or less of the original length. Keep only the most essential elements. Make every word count. Perfect for SMS or social.'
            },
            {
                id: 'longer',
                name: 'üìù Longer Version',
                class: 'longer',
                prompt: 'Expand this into a longer, more detailed version. Add more context, storytelling, and emotional depth. Include additional proof points or testimonials. Good for email.'
            },
            {
                id: 'voice',
                name: 'üé≠ Different Voice',
                class: 'voice',
                prompt: 'Rewrite from a different perspective - a veteran\'s wife, a volunteer, a beneficiary, a board member, or a fellow donor. Make it personal and authentic from their point of view.'
            },
            {
                id: 'ask',
                name: 'üí∞ Different Ask',
                class: 'ask',
                prompt: 'Keep the copy but change the ask strategy. Try a different amount, offer a match, suggest monthly giving, or use an "any amount helps" approach. Test different ask strings.'
            },
            {
                id: 'question',
                name: '‚ùì Question Lead',
                class: 'question',
                prompt: 'Rewrite to open with a powerful, thought-provoking question that hooks the reader. The question should create curiosity or tap into a shared concern.'
            },
            {
                id: 'story',
                name: 'üìñ Story Lead',
                class: 'story',
                prompt: 'Rewrite to lead with a specific, vivid story about one person or moment. Use sensory details, dialogue, and narrative tension before transitioning to the ask.'
            },
            {
                id: 'fear',
                name: 'üò∞ Fear Angle',
                class: 'fear',
                prompt: 'Rewrite emphasizing what happens if the reader DOESN\'T act. Paint the negative consequences vividly. What will be lost? Who will suffer? Use ethical fear-based persuasion.'
            },
            {
                id: 'gratitude',
                name: 'üôè Gratitude Angle',
                class: 'gratitude',
                prompt: 'Rewrite leading with sincere gratitude and appreciation. Thank the reader for past support, acknowledge their generosity, then invite them to continue their impact.'
            }
        ];

        let generatedVariations = [];

        async function generateVariations() {
            const creative = creativeInput.value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const model = document.getElementById('modelName').value.trim() || 'gpt-4o-mini';

            if (!creative) {
                showError('Please paste your creative copy first!');
                return;
            }

            if (!apiKey) {
                showError('Please enter your OpenAI API key');
                return;
            }

            // Save API key
            localStorage.setItem('whatif_apikey', apiKey);

            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loadingOverlay');
            const loadingStrategy = document.getElementById('loadingStrategy');

            btn.classList.add('loading');
            btn.disabled = true;
            loading.classList.add('visible');
            hideError();

            generatedVariations = [];

            try {
                for (let i = 0; i < strategies.length; i++) {
                    const strategy = strategies[i];
                    loadingStrategy.textContent = `${strategy.name}`;

                    const variation = await generateSingleVariation(creative, strategy, apiKey, model);
                    generatedVariations.push({
                        ...strategy,
                        text: variation
                    });

                    // Update progress
                    loadingStrategy.textContent = `${strategy.name} ‚úì (${i + 1}/10)`;
                }

                displayVariations();
            } catch (error) {
                showError(`Error: ${error.message}`);
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
                loading.classList.remove('visible');
            }
        }

        async function generateSingleVariation(original, strategy, apiKey, model) {
            const systemPrompt = `You are an expert fundraising copywriter. Your task is to create A/B test variations of winning fundraising copy.

Rules:
1. Maintain the core message and call to action
2. Keep the same general offer/ask unless told otherwise
3. Output ONLY the new copy - no explanations, no headers, no "Here's the variation"
4. Match the format of the original (if it's an email, output email; if SMS, output SMS)
5. Be creative but authentic - this is for a real nonprofit`;

            const userPrompt = `Original winning creative:
---
${original}
---

${strategy.prompt}

Output only the new variation, nothing else:`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: userPrompt }
                    ],
                    temperature: 0.8,
                    max_tokens: 2000
                })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || 'API request failed');
            }

            const data = await response.json();
            return data.choices[0].message.content.trim();
        }

        function displayVariations() {
            const grid = document.getElementById('variationsGrid');
            const section = document.getElementById('resultsSection');

            grid.innerHTML = generatedVariations.map((v, i) => {
                const chars = v.text.length;
                let charClass = 'short';
                if (chars > 500) charClass = 'medium';
                if (chars > 1000) charClass = 'long';

                return `
                    <div class="variation-card">
                        <div class="variation-header" style="border-left: 4px solid var(--accent-purple);">
                            <div class="variation-title">${v.name}</div>
                            <div class="variation-meta">
                                <span class="variation-chars ${charClass}">${chars} chars</span>
                                <button class="copy-btn" onclick="copyVariation(${i}, this)">Copy</button>
                            </div>
                        </div>
                        <div class="variation-body">
                            <div class="variation-text">${escapeHtml(v.text)}</div>
                        </div>
                    </div>
                `;
            }).join('');

            section.classList.add('visible');
            section.scrollIntoView({ behavior: 'smooth' });
        }

        function copyVariation(index, btn) {
            const text = generatedVariations[index].text;
            navigator.clipboard.writeText(text);

            btn.textContent = 'Copied!';
            btn.classList.add('copied');

            setTimeout(() => {
                btn.textContent = 'Copy';
                btn.classList.remove('copied');
            }, 2000);
        }

        function copyAllVariations() {
            const original = creativeInput.value.trim();
            let allText = `# What If Machine - A/B Test Variations\n\n`;
            allText += `## Original Creative (${original.length} chars)\n${original}\n\n`;
            allText += `---\n\n`;

            generatedVariations.forEach((v, i) => {
                allText += `## ${i + 1}. ${v.name} (${v.text.length} chars)\n`;
                allText += `${v.text}\n\n---\n\n`;
            });

            navigator.clipboard.writeText(allText);

            const btn = document.querySelector('.copy-all-btn');
            btn.textContent = '‚úì Copied All!';
            setTimeout(() => {
                btn.textContent = 'üìã Copy All';
            }, 2000);
        }

        function showError(message) {
            const el = document.getElementById('errorMessage');
            el.textContent = message;
            el.classList.add('visible');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('visible');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
