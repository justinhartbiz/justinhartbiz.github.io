<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opening Line Forensics â€” NRSC / RNC / NRCC</title>
<style>
:root{--bg:#0a0a0f;--card:#12121a;--border:#1e1e2e;--text:#e0e0e8;--dim:#7a7a8e;--accent:#6366f1;--green:#22c55e;--red:#ef4444;--yellow:#eab308;--blue:#3b82f6}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.5}
.container{max-width:1400px;margin:0 auto;padding:20px}
h1{font-size:28px;font-weight:700;margin-bottom:4px}
.subtitle{color:var(--dim);margin-bottom:24px;font-size:14px}
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:24px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
.stat-card .label{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--dim)}
.stat-card .value{font-size:28px;font-weight:700;margin-top:4px}
.stat-card .sub{font-size:12px;color:var(--dim);margin-top:2px}
.controls{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;align-items:center}
select,input{background:var(--card);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:6px;font-size:13px}
input[type=text]{width:280px}
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;margin:1px}
.tag-curiosity_gap{background:#6366f133;color:#818cf8}
.tag-celebrity_signer{background:#f59e0b33;color:#fbbf24}
.tag-personal_intro{background:#8b5cf633;color:#a78bfa}
.tag-poll_survey{background:#3b82f633;color:#60a5fa}
.tag-personalization{background:#22c55e33;color:#4ade80}
.tag-geo_personalization{background:#14b8a633;color:#2dd4bf}
.tag-urgency{background:#ef444433;color:#f87171}
.tag-guilt_plea{background:#ec489933;color:#f472b6}
.tag-notification_style{background:#f9731633;color:#fb923c}
.tag-question{background:#06b6d433;color:#22d3ee}
.tag-status_elevation{background:#a855f733;color:#c084fc}
.tag-emoji{background:#eab30833;color:#facc15}
.tag-quiz_gamification{background:#10b98133;color:#34d399}
.tag-defiance{background:#dc262633;color:#f87171}
.tag-farewell{background:#78716c33;color:#a8a29e}
.tag-congratulatory{background:#84cc1633;color:#a3e635}
.tag-all_caps{background:#64748b33;color:#94a3b8}
.tag-insider{background:#7c3aed33;color:#a78bfa}
.tag-generic{background:#37415133;color:#6b7280}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px;border-bottom:2px solid var(--border);color:var(--dim);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;cursor:pointer;user-select:none;white-space:nowrap}
th:hover{color:var(--accent)}
td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
tr:hover{background:#ffffff06}
.opener-text{max-width:500px;font-size:13px;line-height:1.4}
.copy-btn{background:var(--accent);color:#fff;border:none;padding:3px 8px;border-radius:4px;font-size:11px;cursor:pointer;opacity:0.7}
.copy-btn:hover{opacity:1}
.num{font-variant-numeric:tabular-nums;text-align:right}
.high{color:var(--green);font-weight:600}
.laws{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px;margin-bottom:24px}
.law{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px}
.law-num{font-size:11px;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:1px}
.law-title{font-size:15px;font-weight:700;margin:4px 0}
.law-stat{font-size:12px;color:var(--dim)}
.enrichment-bar{display:inline-block;height:6px;border-radius:3px;background:var(--accent);min-width:4px}
.section-title{font-size:18px;font-weight:700;margin:24px 0 12px;padding-top:12px;border-top:1px solid var(--border)}
.toast{position:fixed;bottom:20px;right:20px;background:var(--green);color:#000;padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;opacity:0;transition:opacity 0.3s}
.toast.show{opacity:1}
</style>
</head>
<body>
<div class="container">
<h1>ðŸ“Š Opening Line Forensics</h1>
<p class="subtitle">NRSC Â· RNC Â· NRCC â€” 3,297 creatives analyzed | Internal use only</p>

<div class="stats-row" id="topStats"></div>

<div class="section-title">The 10 Laws of Opening Lines</div>
<div class="laws" id="lawsGrid"></div>

<div class="section-title">Pattern Enrichment (Top 50 vs Bottom Half)</div>
<div id="enrichmentChart" style="margin-bottom:24px"></div>

<div class="section-title">All Openers â€” Browse, Sort & Filter</div>
<div class="controls">
<select id="clientFilter"><option value="">All Clients</option><option value="NRSC">NRSC</option><option value="RNC">RNC</option><option value="NRCC">NRCC</option></select>
<select id="patternFilter"><option value="">All Patterns</option></select>
<select id="minPolls"><option value="1">Min 1 poll</option><option value="5">Min 5 polls</option><option value="10">Min 10 polls</option><option value="20">Min 20 polls</option><option value="50">Min 50 polls</option></select>
<input type="text" id="searchBox" placeholder="Search openers...">
<span id="resultCount" style="color:var(--dim);font-size:12px"></span>
</div>

<table>
<thead><tr>
<th data-sort="creative">Creative</th>
<th data-sort="client">Client</th>
<th data-sort="opener">Opener</th>
<th>Patterns</th>
<th data-sort="polls" class="num">Polls â–¼</th>
<th data-sort="sent" class="num">Sent</th>
<th data-sort="donated" class="num">Revenue</th>
<th data-sort="yield_send" class="num">Yield</th>
<th></th>
</tr></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
<div class="toast" id="toast">Copied!</div>

<script>
// Data will be embedded
let DATA = [];

const LAWS = [
  {num:1, title:"Open Loops, Don't Close Them", stat:"Curiosity gap: 6.1x enriched in top 50", pattern:"curiosity_gap"},
  {num:2, title:"Name-Drop, Then Speak", stat:"Celebrity signer: 2.4x enriched, $78K avg rev", pattern:"celebrity_signer"},
  {num:3, title:"'This Is [Name]' Format Wins", stat:"Personal intro: 9.3 avg polls â€” highest single pattern", pattern:"personal_intro"},
  {num:4, title:"Poll/Survey = Scale Machine", stat:"4.2x enriched, drives 40M+ send volumes", pattern:"poll_survey"},
  {num:5, title:"Geo-Personalization Is Underused", stat:"4.2x enriched, only 3% of creatives use it", pattern:"geo_personalization"},
  {num:6, title:"Notification Framing = 11x Lift", stat:"Highest enrichment of any pattern", pattern:"notification_style"},
  {num:7, title:"Ask the Right Questions", stat:"Identity-triggering questions > generic asks", pattern:"question"},
  {num:8, title:"Guilt Works When Authentic", stat:"2.9x enriched; emotional vulnerability drives yield", pattern:"guilt_plea"},
  {num:9, title:"ALL CAPS = Spam Signal", stat:"1.7 avg polls, worst-performing pattern", pattern:"all_caps"},
  {num:10, title:"Generic = Death", stat:"0.3x enrichment â€” no hook, no scale", pattern:"generic"},
];

const ENRICHMENT = [
  {pattern:"notification_style", ratio:11.0, top:6, bot:1},
  {pattern:"curiosity_gap", ratio:6.1, top:10, bot:2},
  {pattern:"geo_personalization", ratio:4.2, top:8, bot:2},
  {pattern:"poll_survey", ratio:4.2, top:26, bot:6},
  {pattern:"guilt_plea", ratio:2.9, top:16, bot:5},
  {pattern:"celebrity_signer", ratio:2.4, top:28, bot:12},
  {pattern:"personal_intro", ratio:2.1, top:14, bot:7},
  {pattern:"personalization", ratio:1.5, top:40, bot:27},
  {pattern:"urgency", ratio:1.3, top:14, bot:11},
  {pattern:"emoji", ratio:1.1, top:12, bot:11},
  {pattern:"question", ratio:0.9, top:20, bot:22},
  {pattern:"generic", ratio:0.3, top:8, bot:26},
];

async function loadData(){
  try{
    const r=await fetch('opening-lines-analysis.json');
    const j=await r.json();
    DATA=j.all_analyzed||j.top_100||[];
  }catch(e){DATA=[];}
  init();
}

function init(){
  // Top stats
  const totalPolls=DATA.reduce((s,d)=>s+d.polls,0);
  const totalRev=DATA.reduce((s,d)=>s+d.donated,0);
  const topCreative=DATA[0]||{};
  document.getElementById('topStats').innerHTML=`
    <div class="stat-card"><div class="label">Creatives Analyzed</div><div class="value">${DATA.length.toLocaleString()}</div></div>
    <div class="stat-card"><div class="label">Total Polls</div><div class="value">${totalPolls.toLocaleString()}</div></div>
    <div class="stat-card"><div class="label">Total Revenue</div><div class="value">$${(totalRev/1e6).toFixed(1)}M</div></div>
    <div class="stat-card"><div class="label">#1 Creative</div><div class="value">${topCreative.creative||'â€”'}</div><div class="sub">${topCreative.polls||0} polls Â· $${((topCreative.donated||0)/1000).toFixed(0)}K</div></div>
  `;

  // Laws
  document.getElementById('lawsGrid').innerHTML=LAWS.map(l=>`
    <div class="law" style="cursor:pointer" onclick="document.getElementById('patternFilter').value='${l.pattern}';applyFilters()">
      <div class="law-num">Law ${l.num}</div>
      <div class="law-title">${l.title}</div>
      <div class="law-stat">${l.stat}</div>
    </div>`).join('');

  // Enrichment
  const maxR=Math.max(...ENRICHMENT.map(e=>e.ratio));
  document.getElementById('enrichmentChart').innerHTML='<table style="width:100%">'+ENRICHMENT.map(e=>{
    const w=Math.max((e.ratio/maxR)*300,4);
    const color=e.ratio>=2?'var(--green)':e.ratio>=1?'var(--yellow)':'var(--red)';
    return `<tr><td style="width:160px;padding:4px"><span class="tag tag-${e.pattern}">${e.pattern.replace(/_/g,' ')}</span></td>
    <td style="padding:4px"><div class="enrichment-bar" style="width:${w}px;background:${color}"></div> <span style="font-size:12px;color:var(--dim)">${e.ratio}x</span></td>
    <td class="num" style="padding:4px;font-size:12px;color:var(--dim);width:100px">top ${e.top}% / bot ${e.bot}%</td></tr>`;
  }).join('')+'</table>';

  // Pattern filter options
  const allPatterns=new Set();
  DATA.forEach(d=>(d.patterns||[]).forEach(p=>allPatterns.add(p)));
  const sel=document.getElementById('patternFilter');
  [...allPatterns].sort().forEach(p=>{const o=document.createElement('option');o.value=p;o.textContent=p.replace(/_/g,' ');sel.appendChild(o)});

  // Event listeners
  document.getElementById('clientFilter').onchange=applyFilters;
  document.getElementById('patternFilter').onchange=applyFilters;
  document.getElementById('minPolls').onchange=applyFilters;
  document.getElementById('searchBox').oninput=applyFilters;
  document.querySelectorAll('th[data-sort]').forEach(th=>{
    th.onclick=()=>{
      const k=th.dataset.sort;
      sortDir=sortKey===k?-sortDir:1;
      if(['polls','sent','donated','yield_send'].includes(k))sortDir=-sortDir||(-1);
      sortKey=k;
      applyFilters();
    };
  });

  applyFilters();
}

let sortKey='polls',sortDir=-1;

function applyFilters(){
  const client=document.getElementById('clientFilter').value;
  const pattern=document.getElementById('patternFilter').value;
  const minP=parseInt(document.getElementById('minPolls').value);
  const search=document.getElementById('searchBox').value.toLowerCase();

  let filtered=DATA.filter(d=>{
    if(client&&d.client!==client)return false;
    if(pattern&&!(d.patterns||[]).includes(pattern))return false;
    if(d.polls<minP)return false;
    if(search&&!d.opener.toLowerCase().includes(search)&&!d.creative.toLowerCase().includes(search))return false;
    return true;
  });

  filtered.sort((a,b)=>{
    let va=a[sortKey],vb=b[sortKey];
    if(typeof va==='string')va=va.toLowerCase();
    if(typeof vb==='string')vb=vb.toLowerCase();
    return va<vb?sortDir:va>vb?-sortDir:0;
  });

  document.getElementById('resultCount').textContent=`${filtered.length} results`;

  const tbody=document.getElementById('tableBody');
  tbody.innerHTML=filtered.slice(0,200).map(d=>{
    const tags=(d.patterns||[]).map(p=>`<span class="tag tag-${p}">${p.replace(/_/g,' ')}</span>`).join(' ');
    const yld=typeof d.yield_send==='number'&&d.yield_send>0?'$'+d.yield_send.toFixed(3):'â€”';
    const rev=d.donated?'$'+d.donated.toLocaleString(undefined,{maximumFractionDigits:0}):'â€”';
    const cls=d.polls>=50?'high':'';
    return `<tr>
      <td><strong>${d.creative}</strong></td>
      <td>${d.client}</td>
      <td class="opener-text">${escHtml(d.opener)}</td>
      <td>${tags}</td>
      <td class="num ${cls}">${d.polls}</td>
      <td class="num">${d.sent?d.sent.toLocaleString():'â€”'}</td>
      <td class="num">${rev}</td>
      <td class="num">${yld}</td>
      <td><button class="copy-btn" onclick="copyText(this,'${escAttr(d.opener)}')">Copy</button></td>
    </tr>`;
  }).join('');
}

function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
function escAttr(s){return s.replace(/'/g,"\\'").replace(/"/g,'&quot;').replace(/\\/g,'\\\\')}
function copyText(btn,text){
  navigator.clipboard.writeText(text.replace(/&quot;/g,'"').replace(/\\'/g,"'"));
  const t=document.getElementById('toast');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1500);
}

loadData();
</script>
</body>
</html>
